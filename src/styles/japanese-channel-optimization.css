/* ğŸ‡¯ğŸ‡µ Japanese Channel Optimization - æ—¥è¯­é¢‘é“ä¸“é¡¹ä¼˜åŒ–
 * ç¡®ä¿æ—¥è¯­å†…å®¹åœ¨é¢‘é“ä¸­èˆ’é€‚ã€æ­£ç¡®ã€æ¸…æ™°åœ°æ˜¾ç¤º
 * ä¸“é—¨é’ˆå¯¹æ—¥è¯­é¢‘é“çš„å­—ä½“ã€é—´è·ã€æ’ç‰ˆä¼˜åŒ–
 */

:root {
  /* ğŸŒ æ—¥è¯­é¢‘é“ä¸“ç”¨å­—ä½“å‚æ•° */
  --japanese-channel-font-family: 
    'Hiragino Kaku Gothic ProN', 
    'Hiragino Sans', 
    'Yu Gothic Medium', 
    'Yu Gothic', 
    'Meiryo', 
    'Source Han Sans JP', 
    'Noto Sans CJK JP', 
    'MS PGothic',
    -apple-system, 
    BlinkMacSystemFont, 
    sans-serif;
    
  /* ğŸ“ æ—¥è¯­ä¸“ç”¨æ’ç‰ˆå‚æ•° - é¢‘é“ä¼˜åŒ– */
  --japanese-letter-spacing-channel: 0.025em;  /* é¢‘é“ä¸­æ—¥è¯­å­—ç¬¦é—´è· */
  --japanese-line-height-channel: 1.65;       /* é¢‘é“ä¸­æ—¥è¯­è¡Œé«˜ */
  --japanese-word-spacing: 0.1em;             /* æ—¥è¯­å•è¯é—´è· */
  
  /* ğŸ¨ æ—¥è¯­æ¸²æŸ“å¢å¼º */
  --japanese-font-synthesis: weight style;     /* å­—ä½“åˆæˆ */
  --japanese-font-variant: normal;             /* å­—ä½“å˜ä½“ */
  --japanese-text-decoration-skip-ink: auto;   /* æ–‡æœ¬è£…é¥°è·³è¿‡å¢¨æ°´ */
}

/* ğŸ·ï¸ æ—¥è¯­é¢‘é“æ ‡é¢˜ä¼˜åŒ– */
.channel-title,
.chat-title,
h1, h2, h3 {
  font-family: var(--japanese-channel-font-family) !important;
  letter-spacing: var(--japanese-letter-spacing-channel) !important;
  line-height: var(--japanese-line-height-channel) !important;
  word-spacing: var(--japanese-word-spacing) !important;
  font-synthesis: var(--japanese-font-synthesis);
  font-variant: var(--japanese-font-variant);
  text-decoration-skip-ink: var(--japanese-text-decoration-skip-ink);
  
  /* ğŸ¯ æ—¥è¯­ç‰¹æ®Šå¤„ç† */
  word-break: keep-all !important;             /* ä¿æŒæ—¥è¯­å•è¯å®Œæ•´ */
  overflow-wrap: break-word !important;        /* å…è®¸é•¿å•è¯æ¢è¡Œ */
  hyphens: none !important;                    /* ç¦ç”¨è¿å­—ç¬¦ */
  
  /* ğŸŒŸ è§†è§‰å¢å¼º */
  text-rendering: optimizeLegibility !important;
  -webkit-font-smoothing: antialiased !important;
  -moz-osx-font-smoothing: grayscale !important;
}

/* ğŸ“ æ—¥è¯­æ¶ˆæ¯å†…å®¹ä¸“é¡¹ä¼˜åŒ– */
.discord-message-item .content-wrapper,
.message-content,
.message-text {
  font-family: var(--japanese-channel-font-family) !important;
  letter-spacing: var(--japanese-letter-spacing-channel) !important;
  line-height: var(--japanese-line-height-channel) !important;
  word-spacing: var(--japanese-word-spacing) !important;
  
  /* ğŸ¯ æ—¥è¯­æ’ç‰ˆä¸“ç”¨è®¾ç½® */
  word-break: keep-all !important;
  overflow-wrap: break-word !important;
  hyphens: none !important;
  white-space: pre-wrap !important;            /* ä¿æŒç©ºç™½å­—ç¬¦ */
  
  /* ğŸŒŸ æ¸²æŸ“ä¼˜åŒ– */
  text-rendering: optimizeLegibility !important;
  -webkit-font-smoothing: antialiased !important;
  -moz-osx-font-smoothing: grayscale !important;
  font-feature-settings: 'liga' 1, 'kern' 1, 'palt' 1 !important;
}

/* ğŸ‘¤ æ—¥è¯­ç”¨æˆ·åä¼˜åŒ– */
.username-button,
.sender-name {
  font-family: var(--japanese-channel-font-family) !important;
  letter-spacing: var(--japanese-letter-spacing-channel) !important;
  word-break: keep-all !important;
  overflow-wrap: break-word !important;
  
  /* ğŸ¨ ç”¨æˆ·åç‰¹æ®Šå¤„ç† */
  font-weight: 500 !important;
  text-rendering: optimizeLegibility !important;
}

/* ğŸ• æ—¶é—´æˆ³ä¿æŒå¯è¯»æ€§ */
.message-timestamp,
time {
  font-family: var(--japanese-channel-font-family) !important;
  letter-spacing: normal !important;  /* æ—¶é—´æˆ³ä¸éœ€è¦é¢å¤–é—´è· */
}

/* ğŸ¯ ç‰¹å®šæ—¥è¯­å­—ç¬¦ä¼˜åŒ– */

/* å¹³å‡åä¼˜åŒ– */
.content-wrapper :deep(*):lang(ja),
.content-wrapper :deep([lang="ja"]),
*:lang(ja),
[lang="ja"] {
  font-family: var(--japanese-channel-font-family) !important;
  letter-spacing: var(--japanese-letter-spacing-channel) !important;
  line-height: var(--japanese-line-height-channel) !important;
  word-break: keep-all !important;
  overflow-wrap: break-word !important;
}

/* ç‰‡å‡åç‰¹æ®Šå¤„ç† */
.katakana-text,
*[data-script="katakana"] {
  letter-spacing: 0.03em !important;  /* ç‰‡å‡åéœ€è¦ç¨å¾®æ›´å¤§çš„é—´è· */
}

/* æ±‰å­—ï¼ˆæ¼¢å­—ï¼‰å¤„ç† */
.kanji-text,
*[data-script="kanji"] {
  letter-spacing: 0.02em !important;  /* æ±‰å­—é—´è·é€‚ä¸­ */
  line-height: 1.6 !important;
}

/* ğŸ”¤ æ—¥è¯­æ ‡ç‚¹ç¬¦å·ä¼˜åŒ– */
.content-wrapper :deep(*):contains('ã€‚'),
.content-wrapper :deep(*):contains('ã€'),
.content-wrapper :deep(*):contains('ï¼Ÿ'),
.content-wrapper :deep(*):contains('ï¼') {
  /* æ—¥è¯­æ ‡ç‚¹ç¬¦å·å‘¨å›´çš„é—´è·å¤„ç† */
  text-spacing: ideograph-alpha ideograph-numeric;
}

/* ğŸ“± å“åº”å¼æ—¥è¯­ä¼˜åŒ– */
@media (max-width: 768px) {
  :root {
    --japanese-letter-spacing-channel: 0.03em;  /* ç§»åŠ¨ç«¯å¢åŠ é—´è· */
    --japanese-line-height-channel: 1.7;        /* ç§»åŠ¨ç«¯å¢åŠ è¡Œé«˜ */
  }
  
  .discord-message-item .content-wrapper,
  .message-content {
    word-break: break-all !important;           /* ç§»åŠ¨ç«¯å…è®¸å¼ºåˆ¶æ¢è¡Œ */
  }
}

@media (max-width: 480px) {
  :root {
    --japanese-letter-spacing-channel: 0.035em; /* å°å±å¹•è¿›ä¸€æ­¥å¢åŠ é—´è· */
    --japanese-line-height-channel: 1.75;       /* å°å±å¹•è¿›ä¸€æ­¥å¢åŠ è¡Œé«˜ */
  }
}

/* ğŸŒ™ æš—è‰²ä¸»é¢˜æ—¥è¯­ä¼˜åŒ– */
@media (prefers-color-scheme: dark) {
  :root {
    --japanese-channel-font-family: 
      'Hiragino Kaku Gothic ProN', 
      'Yu Gothic Medium',           /* æš—è‰²ä¸»é¢˜ä¸‹ä¼˜å…ˆä¸­ç­‰å­—é‡ */
      'Yu Gothic', 
      'Meiryo', 
      'Source Han Sans JP', 
      'Noto Sans CJK JP', 
      'MS PGothic',
      -apple-system, 
      BlinkMacSystemFont, 
      sans-serif;
  }
  
  .discord-message-item .content-wrapper,
  .message-content,
  .username-button {
    -webkit-font-smoothing: subpixel-antialiased !important;
    font-weight: 450 !important;                /* æš—è‰²ä¸»é¢˜ä¸‹ç¨å¾®å¢åŠ å­—é‡ */
  }
}

/* ğŸ–¨ï¸ é«˜åˆ†è¾¨ç‡å±å¹•æ—¥è¯­ä¼˜åŒ– */
@media (min-resolution: 2dppx) {
  .discord-message-item .content-wrapper,
  .message-content,
  .channel-title {
    -webkit-font-smoothing: subpixel-antialiased !important;
    text-rendering: geometricPrecision !important;
  }
}

/* ğŸ¯ é«˜å¯¹æ¯”åº¦æ¨¡å¼æ—¥è¯­å¢å¼º */
@media (prefers-contrast: high) {
  .discord-message-item .content-wrapper,
  .message-content,
  .username-button {
    font-weight: 600 !important;                /* é«˜å¯¹æ¯”åº¦ä¸‹å¢åŠ å­—é‡ */
    letter-spacing: calc(var(--japanese-letter-spacing-channel) + 0.01em) !important;
  }
}

/* ğŸ” æœç´¢ç»“æœä¸­çš„æ—¥è¯­é«˜äº® */
mark:lang(ja),
.search-highlight:lang(ja),
.highlighted-text:lang(ja) {
  font-family: var(--japanese-channel-font-family) !important;
  letter-spacing: var(--japanese-letter-spacing-channel) !important;
  background-color: rgba(255, 235, 59, 0.4) !important; /* æ—¥è¯­é«˜äº®ç¨å¾®åŠ å¼º */
  padding: 0.1em 0.3em !important;
  border-radius: 3px !important;
}

/* ğŸ¨ æ—¥è¯­é¢‘é“ç‰¹æ®Šå…ƒç´  */

/* è¡¨æƒ…ç¬¦å·ä¸æ—¥è¯­æ–‡æœ¬çš„åè°ƒ */
.emoji + *:lang(ja),
*:lang(ja) + .emoji {
  margin-left: 0.15em !important;
  margin-right: 0.15em !important;
}

/* æ—¥è¯­å¼•ç”¨å—ä¼˜åŒ– */
blockquote:lang(ja),
.quote-block:lang(ja) {
  font-family: var(--japanese-channel-font-family) !important;
  letter-spacing: var(--japanese-letter-spacing-channel) !important;
  line-height: var(--japanese-line-height-channel) !important;
  border-left: 3px solid #7c3aed !important;   /* ç´«è‰²å¼•ç”¨çº¿ï¼Œä¸æ—¥è¯­åŒ¹é… */
  padding-left: 1em !important;
  font-style: normal !important;               /* æ—¥è¯­å¼•ç”¨ä¸ä½¿ç”¨æ–œä½“ */
}

/* æ—¥è¯­åˆ—è¡¨é¡¹ä¼˜åŒ– */
li:lang(ja),
.list-item:lang(ja) {
  font-family: var(--japanese-channel-font-family) !important;
  letter-spacing: var(--japanese-letter-spacing-channel) !important;
  line-height: var(--japanese-line-height-channel) !important;
  margin-bottom: 0.5em !important;             /* æ—¥è¯­åˆ—è¡¨é¡¹é—´è· */
}

/* æ—¥è¯­é“¾æ¥ä¼˜åŒ– */
a:lang(ja),
.link:lang(ja) {
  font-family: inherit !important;
  letter-spacing: inherit !important;
  text-decoration: underline !important;
  text-decoration-color: #7c3aed !important;   /* ç´«è‰²ä¸‹åˆ’çº¿ */
  text-decoration-thickness: 1px !important;
  text-underline-offset: 0.2em !important;
}

/* ğŸš¨ å¼ºåˆ¶åº”ç”¨ - æœ€é«˜ä¼˜å…ˆçº§ */
.japanese-channel-optimized,
.force-japanese-font {
  font-family: var(--japanese-channel-font-family) !important;
  letter-spacing: var(--japanese-letter-spacing-channel) !important;
  line-height: var(--japanese-line-height-channel) !important;
  word-break: keep-all !important;
  overflow-wrap: break-word !important;
  text-rendering: optimizeLegibility !important;
  -webkit-font-smoothing: antialiased !important;
  -moz-osx-font-smoothing: grayscale !important;
}

/* ğŸ“ è°ƒè¯•å·¥å…·ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰ */
@media screen and (min-width: 0) {
  .debug-japanese-font {
    outline: 1px dashed #7c3aed !important;
    position: relative;
  }
  
  .debug-japanese-font::after {
    content: 'JP';
    position: absolute;
    top: -1em;
    right: 0;
    background: #7c3aed;
    color: white;
    padding: 2px 4px;
    font-size: 10px;
    border-radius: 2px;
    font-family: monospace;
  }
} 