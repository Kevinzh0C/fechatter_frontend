<!DOCTYPE html>
<html>

<head>
  <title>ğŸ”§ æ¶ˆæ¯å¯è§æ€§ä¿®å¤éªŒè¯</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f7fa;
    }

    .panel {
      background: white;
      padding: 20px;
      margin: 15px 0;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .success {
      color: #10b981;
      font-weight: bold;
    }

    .error {
      color: #ef4444;
      font-weight: bold;
    }

    .warning {
      color: #f59e0b;
      font-weight: bold;
    }

    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }

    button:hover {
      background: #4f46e5;
    }

    .code {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      padding: 12px;
      border-radius: 4px;
      font-family: monospace;
      margin: 10px 0;
    }

    .fix-applied {
      background: #dcfce7;
      border: 1px solid #bbf7d0;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
  </style>
</head>

<body>
  <h1>ğŸ”§ æ¶ˆæ¯å¯è§æ€§ä¿®å¤éªŒè¯å·¥å…·</h1>
  <p>éªŒè¯åˆšåˆšåº”ç”¨çš„CSSä¿®å¤æ˜¯å¦è§£å†³äº†æ¶ˆæ¯å†…å®¹ä¸å¯è§é—®é¢˜</p>

  <div class="panel">
    <h3>ğŸ¯ ä¿®å¤å†…å®¹</h3>
    <div class="fix-applied">
      <strong>âœ… å·²åº”ç”¨çš„ä¿®å¤ï¼š</strong>
      <ul>
        <li><strong>.messages-wrapper</strong>: ä¿®å¤å®¹å™¨é«˜åº¦ (min-height: calc(100vh - 100px))</li>
        <li><strong>.message-item</strong>: å¼ºåˆ¶å¯è§æ€§ (display: block !important)</li>
        <li><strong>.message-text</strong>: å¼ºåˆ¶æ–‡æœ¬æ˜¾ç¤º (opacity: 1 !important)</li>
      </ul>
    </div>

    <button onclick="runVerification()">ğŸš€ å¼€å§‹éªŒè¯</button>
    <button onclick="forceRefresh()">ğŸ”„ å¼ºåˆ¶åˆ·æ–°</button>
    <button onclick="showElementStats()">ğŸ“Š æ˜¾ç¤ºå…ƒç´ ç»Ÿè®¡</button>
  </div>

  <div id="results"></div>

  <script>
    function log(message, type = 'info') {
      const results = document.getElementById('results');
      const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
      results.innerHTML += `<div class="panel"><span class="${className}">${message}</span></div>`;
    }

    async function runVerification() {
      log('ğŸš€ å¼€å§‹éªŒè¯ä¿®å¤æ•ˆæœ...');

      // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½
      await new Promise(resolve => setTimeout(resolve, 1000));

      // æ£€æŸ¥æ¶ˆæ¯å…ƒç´ 
      const messageItems = document.querySelectorAll('[data-message-id]');
      log(`ğŸ“Š æ‰¾åˆ° ${messageItems.length} ä¸ªæ¶ˆæ¯å…ƒç´ `);

      if (messageItems.length === 0) {
        log('âŒ ä»æœªæ‰¾åˆ°æ¶ˆæ¯å…ƒç´ ï¼Œéœ€è¦æ£€æŸ¥Vueç»„ä»¶æ¸²æŸ“', 'error');
        return;
      }

      let visibleCount = 0;
      let contentCount = 0;

      for (let i = 0; i < Math.min(5, messageItems.length); i++) {
        const item = messageItems[i];
        const messageId = item.getAttribute('data-message-id');
        const rect = item.getBoundingClientRect();

        // æ£€æŸ¥å¯è§æ€§
        const isVisible = rect.width > 0 && rect.height > 0;
        if (isVisible) visibleCount++;

        // æ£€æŸ¥æ–‡æœ¬å†…å®¹
        const textElement = item.querySelector('.message-text');
        if (textElement) {
          const textContent = textElement.textContent || textElement.innerHTML;
          if (textContent.trim().length > 0) contentCount++;

          const textRect = textElement.getBoundingClientRect();
          const textVisible = textRect.width > 0 && textRect.height > 0;

          log(`<div class="code">
æ¶ˆæ¯ ${messageId}:
â€¢ å®¹å™¨å°ºå¯¸: ${rect.width}x${rect.height}
â€¢ æ–‡æœ¬å°ºå¯¸: ${textRect.width}x${textRect.height}  
â€¢ å†…å®¹é•¿åº¦: ${textContent.length} å­—ç¬¦
â€¢ çŠ¶æ€: ${isVisible && textVisible ? 'âœ… å¯è§' : 'âŒ ä¸å¯è§'}
                    </div>`);
        } else {
          log(`âŒ æ¶ˆæ¯ ${messageId} ç¼ºå°‘ .message-text å…ƒç´ `, 'error');
        }
      }

      // æ€»ç»“ç»“æœ
      const successRate = Math.round((visibleCount / Math.min(5, messageItems.length)) * 100);

      if (successRate >= 80) {
        log(`ğŸ‰ ä¿®å¤æˆåŠŸï¼${visibleCount}/${Math.min(5, messageItems.length)} æ¶ˆæ¯å¯è§ (${successRate}%)`, 'success');
      } else if (successRate >= 50) {
        log(`âš ï¸ éƒ¨åˆ†ä¿®å¤ï¼${visibleCount}/${Math.min(5, messageItems.length)} æ¶ˆæ¯å¯è§ (${successRate}%)`, 'warning');
      } else {
        log(`âŒ ä¿®å¤å¤±è´¥ï¼${visibleCount}/${Math.min(5, messageItems.length)} æ¶ˆæ¯å¯è§ (${successRate}%)`, 'error');
      }

      // æ£€æŸ¥CSSåº”ç”¨çŠ¶æ€
      checkCSSApplication();
    }

    function checkCSSApplication() {
      log('ğŸ¨ æ£€æŸ¥CSSä¿®å¤åº”ç”¨çŠ¶æ€...');

      const messagesWrapper = document.querySelector('.messages-wrapper');
      if (messagesWrapper) {
        const styles = getComputedStyle(messagesWrapper);
        log(`<div class="code">
.messages-wrapper æ ·å¼:
â€¢ min-height: ${styles.minHeight}
â€¢ display: ${styles.display}
â€¢ flex-direction: ${styles.flexDirection}
                </div>`);

        if (styles.minHeight.includes('calc') || styles.minHeight.includes('vh')) {
          log('âœ… .messages-wrapper é«˜åº¦ä¿®å¤å·²åº”ç”¨', 'success');
        } else {
          log('âŒ .messages-wrapper é«˜åº¦ä¿®å¤æœªç”Ÿæ•ˆ', 'error');
        }
      }

      const messageText = document.querySelector('.message-text');
      if (messageText) {
        const styles = getComputedStyle(messageText);
        log(`<div class="code">
.message-text æ ·å¼:
â€¢ display: ${styles.display}
â€¢ visibility: ${styles.visibility}
â€¢ opacity: ${styles.opacity}
â€¢ min-height: ${styles.minHeight}
                </div>`);

        if (styles.opacity === '1' && styles.visibility === 'visible') {
          log('âœ… .message-text å¯è§æ€§ä¿®å¤å·²åº”ç”¨', 'success');
        } else {
          log('âŒ .message-text å¯è§æ€§ä¿®å¤æœªç”Ÿæ•ˆ', 'error');
        }
      }
    }

    function forceRefresh() {
      log('ğŸ”„ å¼ºåˆ¶åˆ·æ–°é¡µé¢...');
      window.location.reload();
    }

    function showElementStats() {
      log('ğŸ“Š æ˜¾ç¤ºè¯¦ç»†å…ƒç´ ç»Ÿè®¡...');

      const stats = {
        'data-message-id': document.querySelectorAll('[data-message-id]').length,
        '.simple-message-list': document.querySelectorAll('.simple-message-list').length,
        '.messages-wrapper': document.querySelectorAll('.messages-wrapper').length,
        '.message-wrapper': document.querySelectorAll('.message-wrapper').length,
        '.message-item': document.querySelectorAll('.message-item').length,
        '.message-content': document.querySelectorAll('.message-content').length,
        '.message-text': document.querySelectorAll('.message-text').length
      };

      log(`<div class="code">
å…ƒç´ ç»Ÿè®¡:
${Object.entries(stats).map(([selector, count]) => `â€¢ ${selector}: ${count} ä¸ª`).join('\n')}
            </div>`);
    }

    // è‡ªåŠ¨éªŒè¯
    window.addEventListener('load', () => {
      log('ğŸ¯ é¡µé¢åŠ è½½å®Œæˆï¼Œ2ç§’åè‡ªåŠ¨å¼€å§‹éªŒè¯...');
      setTimeout(runVerification, 2000);
    });
  </script>
</body>

</html>