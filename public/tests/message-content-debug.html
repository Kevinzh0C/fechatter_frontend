<!DOCTYPE html>
<html>

<head>
  <title>ğŸ” æ¶ˆæ¯å†…å®¹è°ƒè¯•å·¥å…·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .panel {
      background: #f9f9f9;
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
    }

    .error {
      color: #d63384;
    }

    .success {
      color: #198754;
    }

    .warning {
      color: #fd7e14;
    }

    button {
      padding: 8px 16px;
      margin: 5px;
      cursor: pointer;
    }

    .code {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 3px;
      font-family: monospace;
    }
  </style>
</head>

<body>
  <h1>ğŸ” æ¶ˆæ¯å†…å®¹è°ƒè¯•å·¥å…·</h1>

  <div class="panel">
    <button onclick="checkMessages()">æ£€æŸ¥æ¶ˆæ¯å…ƒç´ </button>
    <button onclick="checkCSS()">æ£€æŸ¥CSSæ ·å¼</button>
    <button onclick="fixCSS()">åº”ç”¨CSSä¿®å¤</button>
  </div>

  <div id="output"></div>

  <script>
    function log(message, type = 'info') {
      const output = document.getElementById('output');
      const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
      output.innerHTML += `<div class="panel ${className}">${message}</div>`;
    }

    function checkMessages() {
      log('ğŸ” å¼€å§‹æ£€æŸ¥æ¶ˆæ¯å…ƒç´ ...');

      const messageItems = document.querySelectorAll('[data-message-id]');
      log(`æ‰¾åˆ° ${messageItems.length} ä¸ªæ¶ˆæ¯å…ƒç´ `);

      if (messageItems.length === 0) {
        log('âŒ æœªæ‰¾åˆ°ä»»ä½•æ¶ˆæ¯å…ƒç´ ï¼', 'error');

        // æ£€æŸ¥å…¶ä»–å¯èƒ½çš„é€‰æ‹©å™¨
        const selectors = ['.message-item', '.message-wrapper', '.simple-message-list', '.messages-wrapper'];
        selectors.forEach(selector => {
          const count = document.querySelectorAll(selector).length;
          log(`${selector}: ${count} ä¸ª`);
        });
        return;
      }

      // æ£€æŸ¥å‰å‡ ä¸ªæ¶ˆæ¯
      for (let i = 0; i < Math.min(3, messageItems.length); i++) {
        const item = messageItems[i];
        const messageId = item.getAttribute('data-message-id');

        log(`<div class="code">
æ¶ˆæ¯ ${messageId}:
- ç±»å: ${item.className}
- æ˜¾ç¤º: ${getComputedStyle(item).display}
- å¯è§æ€§: ${getComputedStyle(item).visibility}
- é€æ˜åº¦: ${getComputedStyle(item).opacity}
</div>`);

        const textElement = item.querySelector('.message-text');
        if (textElement) {
          const content = textElement.textContent || textElement.innerHTML;
          log(`<div class="code">
æ–‡æœ¬å†…å®¹: "${content.substring(0, 100)}..."
æ–‡æœ¬æ˜¾ç¤º: ${getComputedStyle(textElement).display}
æ–‡æœ¬é¢œè‰²: ${getComputedStyle(textElement).color}
</div>`, 'success');
        } else {
          log(`âŒ æ¶ˆæ¯ ${messageId} æ²¡æœ‰ .message-text å…ƒç´ `, 'error');
        }
      }
    }

    function checkCSS() {
      log('ğŸ¨ æ£€æŸ¥CSSæ ·å¼...');

      const selectors = [
        '.simple-message-list',
        '.messages-wrapper',
        '.message-item',
        '.message-text'
      ];

      selectors.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        if (elements.length > 0) {
          const el = elements[0];
          const styles = getComputedStyle(el);

          const issues = [];
          if (styles.display === 'none') issues.push('display: none');
          if (styles.visibility === 'hidden') issues.push('visibility: hidden');
          if (parseFloat(styles.opacity) < 0.1) issues.push('é€æ˜åº¦è¿‡ä½');
          if (styles.height === '0px') issues.push('é«˜åº¦ä¸º0');

          if (issues.length > 0) {
            log(`âš ï¸ ${selector}: ${issues.join(', ')}`, 'warning');
          } else {
            log(`âœ… ${selector}: æ ·å¼æ­£å¸¸`, 'success');
          }
        } else {
          log(`âŒ æœªæ‰¾åˆ° ${selector}`, 'error');
        }
      });
    }

    function fixCSS() {
      log('ğŸ”§ åº”ç”¨CSSä¿®å¤...');

      const style = document.createElement('style');
      style.textContent = `
                .messages-wrapper {
                    min-height: 100% !important;
                    max-width: 900px !important;
                    margin: 0 auto !important;
                    padding: 0 2rem !important;
                }
                .message-item {
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    background: #ffffff !important;
                    border: 1px solid #e5e7eb !important;
                    margin-bottom: 16px !important;
                    padding: 12px 16px !important;
                    border-radius: 8px !important;
                }
                .message-text {
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    color: #374151 !important;
                    line-height: 1.5 !important;
                    word-wrap: break-word !important;
                }
                .message-content {
                    margin-left: 40px !important;
                }
            `;
      document.head.appendChild(style);

      log('âœ… CSSä¿®å¤å·²åº”ç”¨ï¼è¯·æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦æ˜¾ç¤º', 'success');

      // é‡æ–°æ£€æŸ¥
      setTimeout(() => {
        checkMessages();
      }, 500);
    }

    // è‡ªåŠ¨è¿è¡Œæ£€æŸ¥
    window.addEventListener('load', () => {
      setTimeout(() => {
        log('ğŸš€ å¼€å§‹è‡ªåŠ¨è¯Šæ–­...');
        checkMessages();
        checkCSS();
      }, 1000);
    });
  </script>
</body>

</html>