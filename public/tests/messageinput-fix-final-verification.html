<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MessageInput ä¿®å¤æœ€ç»ˆéªŒè¯</title>
    <style>
        body { font-family: system-ui, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 6px; }
        .test-title { font-weight: bold; color: #2563eb; margin-bottom: 10px; }
        .success { background: #dcfce7; border-color: #16a34a; }
        .error { background: #fef2f2; border-color: #dc2626; }
        .warning { background: #fefce8; border-color: #ca8a04; }
        .info { background: #eff6ff; border-color: #2563eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px; overflow-x: auto; }
        button { background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; }
        .fix-item { margin: 10px 0; padding: 10px; border-left: 4px solid #16a34a; background: #f0fdf4; }
        .issue-item { margin: 10px 0; padding: 10px; border-left: 4px solid #dc2626; background: #fef2f2; }
        .test-result { margin-top: 10px; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ MessageInput æ˜¾ç¤ºé—®é¢˜ä¿®å¤ - æœ€ç»ˆéªŒè¯</h1>
        <p>éªŒè¯ä»Chaté¡µé¢åˆ°MessageInputç»„ä»¶çš„å®Œæ•´è°ƒç”¨é“¾è·¯ä¿®å¤æ•ˆæœ</p>

        <div class="test-section success">
            <div class="test-title">âœ… åº”ç”¨çš„ä¿®å¤æªæ–½</div>
            
            <div class="fix-item">
                <strong>1. MessageInput æ¡ä»¶æ¸²æŸ“ä¿æŠ¤</strong><br>
                æ·»åŠ  v-if="currentChatId" ç¡®ä¿åªåœ¨æœ‰æ•ˆchatIdæ—¶æ¸²æŸ“
            </div>
            
            <div class="fix-item">
                <strong>2. DiscordMessageList æ¡ä»¶æ¸²æŸ“ä¿æŠ¤</strong><br>
                æ·»åŠ  v-if="currentChatId" é˜²æ­¢null/NaN chatIdä¼ é€’
            </div>
            
            <div class="fix-item">
                <strong>3. æ”¹è¿›çš„currentChatIdåˆå§‹åŒ–</strong><br>
                å¢å¼º initChatId() å‡½æ•°ï¼Œä¸¥æ ¼éªŒè¯route.params.id
            </div>
            
            <div class="fix-item">
                <strong>4. ä¼˜é›…çš„LoadingçŠ¶æ€</strong><br>
                ä¸ºMessageInputå’ŒDiscordMessageListæ·»åŠ åŠ è½½çŠ¶æ€UI
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ§ª å®æ—¶æµ‹è¯•éªŒè¯</div>
            
            <button onclick="testValidChat()">æµ‹è¯•æœ‰æ•ˆChat ID (/chat/2)</button>
            <button onclick="testInvalidChat()">æµ‹è¯•æ— æ•ˆChat ID (/chat/abc)</button>
            <button onclick="testNoChat()">æµ‹è¯•æ— Chat ID (/chat/)</button>
            <button onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶</button>
            
            <div id="testResults"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”</div>
            <div id="comparisonResults">
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 10px; border: 1px solid #ddd;">é—®é¢˜</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">ä¿®å¤å‰</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">ä¿®å¤å</th>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">MessageInputæ¸²æŸ“</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: #dc2626;">âŒ å› null chatIdå¤±è´¥</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: #16a34a;">âœ… æ¡ä»¶æ¸²æŸ“ä¿æŠ¤</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">NaN APIè¯·æ±‚</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: #dc2626;">âŒ /api/chat/NaN/</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: #16a34a;">âœ… å®Œå…¨æ¶ˆé™¤</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">ç”¨æˆ·ä½“éªŒ</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: #dc2626;">âŒ ç©ºç™½é¡µé¢</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: #16a34a;">âœ… ä¼˜é›…Loading</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">æ§åˆ¶å°é”™è¯¯</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: #dc2626;">âŒ PropséªŒè¯å¤±è´¥</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: #16a34a;">âœ… æ— é”™è¯¯</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ” å®æ—¶çŠ¶æ€ç›‘æ§</div>
            <div id="statusMonitor">ç›‘æ§ä¸­...</div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ¯ æ ¹æœ¬åŸå› æ€»ç»“</div>
            <div>
                <div class="issue-item">
                    <strong>åŸå§‹é—®é¢˜</strong><br>
                    route.params.idä¸ºnull/NaN â†’ currentChatIdä¸ºnull/NaN â†’ 
                    MessageInput required propéªŒè¯å¤±è´¥ â†’ Vueé˜»æ­¢ç»„ä»¶æ¸²æŸ“
                </div>
                
                <div class="fix-item">
                    <strong>è§£å†³æ–¹æ¡ˆ</strong><br>
                    æ·»åŠ v-ifæ¡ä»¶æ¸²æŸ“ + ä¸¥æ ¼çš„IDéªŒè¯ + ä¼˜é›…çš„LoadingçŠ¶æ€ â†’ 
                    é˜²æ­¢æ— æ•ˆpropä¼ é€’ + æå‡ç”¨æˆ·ä½“éªŒ
                </div>
            </div>
        </div>
    </div>

    <script>
        function testValidChat() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="test-result info">ğŸ§ª æµ‹è¯•æœ‰æ•ˆChat ID...</div>';
            
            window.open('/chat/2', '_blank');
            
            setTimeout(() => {
                results.innerHTML += '<div class="test-result success">âœ… å·²æ‰“å¼€ /chat/2 - æ£€æŸ¥MessageInputæ˜¯å¦æ˜¾ç¤ºåœ¨é¡µé¢åº•éƒ¨</div>';
            }, 1000);
        }

        function testInvalidChat() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="test-result info">ğŸ§ª æµ‹è¯•æ— æ•ˆChat ID...</div>';
            
            window.open('/chat/abc', '_blank');
            
            setTimeout(() => {
                results.innerHTML += '<div class="test-result warning">âš ï¸ å·²æ‰“å¼€ /chat/abc - åº”æ˜¾ç¤ºLoadingçŠ¶æ€è€Œéé”™è¯¯</div>';
            }, 1000);
        }

        function testNoChat() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="test-result info">ğŸ§ª æµ‹è¯•æ— Chat ID...</div>';
            
            window.open('/chat/', '_blank');
            
            setTimeout(() => {
                results.innerHTML += '<div class="test-result warning">âš ï¸ å·²æ‰“å¼€ /chat/ - åº”æ˜¾ç¤ºLoadingçŠ¶æ€</div>';
            }, 1000);
        }

        function runFullTest() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="test-result info">ğŸ§ª è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶...</div>';
            
            setTimeout(() => testValidChat(), 500);
            setTimeout(() => testInvalidChat(), 2000);
            setTimeout(() => testNoChat(), 3500);
            
            setTimeout(() => {
                results.innerHTML += '<div class="test-result success">âœ… æµ‹è¯•å¥—ä»¶å®Œæˆ - æ£€æŸ¥æ‰€æœ‰æ‰“å¼€çš„æ ‡ç­¾é¡µ</div>';
            }, 5000);
        }

        function monitorStatus() {
            const monitor = document.getElementById('statusMonitor');
            const currentPath = window.location.pathname;
            
            // æ£€æŸ¥å½“å‰é¡µé¢çŠ¶æ€
            let html = `<pre>å½“å‰é¡µé¢çŠ¶æ€:
URL: ${window.location.href}
è·¯å¾„: ${currentPath}
æ—¶é—´: ${new Date().toLocaleTimeString()}
</pre>`;

            // æ£€æŸ¥DOMå…ƒç´ 
            const checks = [
                { name: 'Chatå®¹å™¨', selector: '.chat-view-container' },
                { name: 'Inputå®¹å™¨', selector: '.input-container' },
                { name: 'MessageInput', selector: '.message-input' },
                { name: 'æ¶ˆæ¯åŠ è½½çŠ¶æ€', selector: '.messages-loading' },
                { name: 'è¾“å…¥åŠ è½½çŠ¶æ€', selector: '.loading-input' },
                { name: 'DiscordMessageList', selector: '.discord-message-list' }
            ];

            html += '<pre>DOMå…ƒç´ æ£€æŸ¥:\n';
            checks.forEach(check => {
                const element = document.querySelector(check.selector);
                const status = element ? 'âœ…' : 'âŒ';
                const visible = element && element.offsetWidth > 0 && element.offsetHeight > 0 ? 'å¯è§' : 'éšè—';
                html += `${status} ${check.name}: ${element ? visible : 'ä¸å­˜åœ¨'}\n`;
            });
            html += '</pre>';

            // æ£€æŸ¥ç½‘ç»œè¯·æ±‚
            const performanceEntries = performance.getEntriesByType('resource');
            const apiRequests = performanceEntries.filter(entry => entry.name.includes('/api/chat/'));
            const nanRequests = apiRequests.filter(entry => entry.name.includes('/chat/NaN/'));
            
            html += `<pre>APIè¯·æ±‚åˆ†æ:
æ€»APIè¯·æ±‚: ${apiRequests.length}
NaNè¯·æ±‚: ${nanRequests.length} ${nanRequests.length === 0 ? 'âœ…' : 'âŒ'}
</pre>`;

            if (nanRequests.length > 0) {
                html += '<div class="test-result error">âŒ ä»ç„¶æ£€æµ‹åˆ°NaN APIè¯·æ±‚ï¼ä¿®å¤å¯èƒ½ä¸å®Œæ•´</div>';
            } else if (apiRequests.length > 0) {
                html += '<div class="test-result success">âœ… æ‰€æœ‰APIè¯·æ±‚æ ¼å¼æ­£ç¡®</div>';
            }

            monitor.innerHTML = html;
        }

        // è‡ªåŠ¨ç›‘æ§
        setInterval(monitorStatus, 2000);
        setTimeout(monitorStatus, 500);

        // ç›‘å¬æ§åˆ¶å°é”™è¯¯
        const originalError = console.error;
        let errorCount = 0;

        console.error = function(...args) {
            errorCount++;
            const message = args.join(' ');
            
            if (message.includes('chatId') || message.includes('required') || message.includes('prop')) {
                document.body.innerHTML += `
                    <div style="position: fixed; top: 10px; right: 10px; background: #dc2626; color: white; padding: 10px; border-radius: 6px; z-index: 9999; max-width: 300px;">
                        âŒ PropséªŒè¯é”™è¯¯:<br>
                        ${message.substring(0, 100)}...
                    </div>`;
            }
            
            originalError.apply(console, args);
        };

        // 3ç§’åæ£€æŸ¥é”™è¯¯è®¡æ•°
        setTimeout(() => {
            if (errorCount === 0) {
                console.log('âœ… æ— æ§åˆ¶å°é”™è¯¯ - ä¿®å¤æˆåŠŸï¼');
            } else {
                console.warn(`âš ï¸ æ£€æµ‹åˆ° ${errorCount} ä¸ªæ§åˆ¶å°é”™è¯¯`);
            }
        }, 3000);
    </script>
</body>
</html>
