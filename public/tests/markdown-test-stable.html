<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stable Markdown Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f7fa;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .panel {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #5865f2;
      padding-bottom: 8px;
    }

    textarea {
      width: 100%;
      height: 400px;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 12px;
      font-family: monospace;
    }

    .preview {
      height: 400px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 12px;
      background: #fafafa;
    }

    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
    }

    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    /* Markdown Preview Styles */
    .markdown-preview h1,
    .markdown-preview h2,
    .markdown-preview h3 {
      color: #333;
    }

    .markdown-preview code {
      background: #f3f4f6;
      padding: 2px 4px;
      border-radius: 3px;
    }

    .markdown-preview pre {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto;
    }

    .markdown-preview blockquote {
      border-left: 4px solid #5865f2;
      margin: 12px 0;
      padding: 8px 16px;
      background: #f8fafc;
    }

    .markdown-preview table {
      border-collapse: collapse;
      width: 100%;
      margin: 12px 0;
    }

    .markdown-preview th,
    .markdown-preview td {
      border: 1px solid #ddd;
      padding: 8px 12px;
      text-align: left;
    }

    .markdown-preview th {
      background: #f3f4f6;
    }

    .markdown-preview .task-checkbox {
      margin-right: 6px;
    }

    .markdown-preview .markdown-highlight {
      background: #fef3c7;
      padding: 2px 4px;
      border-radius: 3px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="panel">
      <h2>ğŸ“ è¾“å…¥ Markdown</h2>
      <textarea id="input" placeholder="åœ¨è¿™é‡Œè¾“å…¥ Markdown...">
# ğŸš€ å¢å¼ºç‰ˆ Markdown é¢„è§ˆæµ‹è¯•

## æ–‡æœ¬æ ¼å¼
è¿™æ˜¯ **ç²—ä½“æ–‡å­—**ã€*æ–œä½“æ–‡å­—* å’Œ `è¡Œå†…ä»£ç `ã€‚

ä½ è¿˜å¯ä»¥ä½¿ç”¨ ~~åˆ é™¤çº¿~~ å’Œ ==é«˜äº®æ–‡æœ¬==ã€‚

## é“¾æ¥å’Œèµ„æº
- [å†…éƒ¨é“¾æ¥](#test)
- [å¤–éƒ¨é“¾æ¥](https://github.com) (æ³¨æ„å›¾æ ‡)
- Email: test@example.com

## ä»£ç å—
```javascript
function markdownTest() {
  console.log("æ”¯æŒè¯­æ³•é«˜äº®!");
  return "ğŸ‰ ç”Ÿäº§å°±ç»ª!";
}
```

```python
def hello_world():
    print("å¤šè¯­è¨€æ”¯æŒ! ğŸ")
    return True
```

## ä»»åŠ¡åˆ—è¡¨
- [x] âœ… å¢å¼ºæ¸²æŸ“
- [x] âœ… ä»£ç è¯­æ³•é«˜äº®
- [ ] ğŸš§ æ•°å­¦å…¬å¼ (è®¡åˆ’ä¸­)
- [ ] ğŸ“Š å›¾è¡¨æ”¯æŒ (è®¡åˆ’ä¸­)

## è¡¨æ ¼
| åŠŸèƒ½ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|------|--------|
| è¯­æ³•é«˜äº® | âœ… å®Œæˆ | é«˜ |
| ä»»åŠ¡åˆ—è¡¨ | âœ… å®Œæˆ | é«˜ |
| å¤–éƒ¨é“¾æ¥ | âœ… å®Œæˆ | ä¸­ |

## å¼•ç”¨å’Œæç¤º
> **ğŸ’¡ ä¸“ä¸šæç¤º:** è¿™ä¸ªå¢å¼ºç‰ˆé¢„è§ˆæ”¯æŒ GitHub é£æ ¼çš„ Markdownï¼Œå¸¦æœ‰è‡ªå®šä¹‰æ ·å¼ä»¥è·å¾—æ›´å¥½çš„å¯è¯»æ€§å’Œç”¨æˆ·ä½“éªŒã€‚

## è¡¨æƒ…ç¬¦å·æ”¯æŒ
æ–‡å­—è¡¨æƒ…ç¬¦å·å¿«æ·æ–¹å¼: :rocket: :heart: :thumbsup: :fire: :star: :check:

è¯•è¯•è¿™äº›: :smile: :laugh: :love: :wink: :cool: :party:
            </textarea>
    </div>

    <div class="panel">
      <h2>ğŸ‘ï¸ å®æ—¶é¢„è§ˆ</h2>
      <div id="preview" class="preview markdown-preview"></div>
    </div>
  </div>

  <div id="status" class="status success">
    âœ… MessageInput ç»„ä»¶å·²å‡çº§ä¸º markdown-it å¼•æ“ï¼Œæ›´ç¨³å®šå¯é ï¼
  </div>

  <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
  <script>
    const input = document.getElementById('input');
    const preview = document.getElementById('preview');
    const status = document.getElementById('status');

    // Initialize markdown-it
    const md = window.markdownit({
      html: true,
      breaks: true,
      linkify: true,
      typographer: true
    });

    // Enhanced link rendering
    const defaultRender = md.renderer.rules.link_open || function (tokens, idx, options, env, renderer) {
      return renderer.renderToken(tokens, idx, options);
    };

    md.renderer.rules.link_open = function (tokens, idx, options, env, renderer) {
      const token = tokens[idx];
      const href = token.attrGet('href');

      if (href && (href.startsWith('http') || href.startsWith('//'))) {
        token.attrSet('target', '_blank');
        token.attrSet('rel', 'noopener noreferrer');
        token.attrPush(['class', 'external-link']);
      }

      return defaultRender(tokens, idx, options, env, renderer);
    };

    function renderMarkdown(content) {
      if (!content.trim()) {
        return '<p style="color: #999; font-style: italic;">å¼€å§‹è¾“å…¥ Markdown...</p>';
      }

      try {
        let html = md.render(content);

        // Post-process for task lists
        html = html.replace(/\[ \]/g, '<input type="checkbox" disabled class="task-checkbox">');
        html = html.replace(/\[x\]/gi, '<input type="checkbox" checked disabled class="task-checkbox">');

        // Post-process for highlights
        html = html.replace(/==(.*?)==/g, '<mark class="markdown-highlight">$1</mark>');

        // Post-process for emoji
        html = html.replace(/:([a-z_]+):/g, (match, emoji) => {
          const emojiMap = {
            smile: 'ğŸ˜Š', heart: 'â¤ï¸', thumbsup: 'ğŸ‘', fire: 'ğŸ”¥',
            rocket: 'ğŸš€', star: 'â­', check: 'âœ…', warning: 'âš ï¸',
            info: 'â„¹ï¸', question: 'â“', bulb: 'ğŸ’¡', gear: 'âš™ï¸',
            laugh: 'ğŸ˜‚', love: 'ğŸ˜', wink: 'ğŸ˜‰', cool: 'ğŸ˜',
            party: 'ğŸ‰', tada: 'ğŸŠ', clap: 'ğŸ‘', ok: 'ğŸ‘Œ'
          };
          return emojiMap[emoji] || match;
        });

        // Add external link icons
        html = html.replace(
          /<a([^>]*class="[^"]*external-link[^"]*"[^>]*)>([^<]*)<\/a>/g,
          '<a$1>$2 ğŸ”—</a>'
        );

        return DOMPurify.sanitize(html);

      } catch (error) {
        status.className = 'status error';
        status.textContent = 'âŒ æ¸²æŸ“é”™è¯¯: ' + error.message;
        return '<p style="color: red;">Markdown æ¸²æŸ“é”™è¯¯</p>';
      }
    }

    function updatePreview() {
      const html = renderMarkdown(input.value);
      preview.innerHTML = html;

      if (!status.textContent.includes('é”™è¯¯')) {
        status.className = 'status success';
        status.textContent = 'âœ… Markdown æ¸²æŸ“æˆåŠŸ! MessageInput ç»„ä»¶å·²å‡çº§ã€‚';
      }
    }

    input.addEventListener('input', updatePreview);
    updatePreview(); // Initial render

    console.log('âœ… Stable Markdown Test loaded successfully!');
    console.log('ğŸ”§ MessageInput component now uses markdown-it engine');
  </script>
</body>

</html>