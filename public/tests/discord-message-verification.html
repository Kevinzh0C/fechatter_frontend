<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¯ DiscordMessageè°ƒç”¨é“¾éªŒè¯å·¥å…·</title>
  <style>
    body {
      font-family: "gg sans", Arial, sans-serif;
      background: #313338;
      color: #dbdee1;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: #2b2d31;
      border-radius: 8px;
    }

    .section {
      background: #2b2d31;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .success {
      color: #3ba55c;
    }

    .warning {
      color: #faa81a;
    }

    .error {
      color: #ed4245;
    }

    .info {
      color: #5865f2;
    }

    .code {
      background: #1e1f22;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Monaco', 'Consolas', monospace;
      margin: 10px 0;
      border-left: 4px solid #5865f2;
    }

    .diagram {
      background: #1e1f22;
      padding: 20px;
      border-radius: 6px;
      margin: 15px 0;
      text-align: center;
    }

    .chain-item {
      display: inline-block;
      background: #5865f2;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      margin: 5px;
      font-weight: 500;
    }

    .arrow {
      font-size: 24px;
      color: #5865f2;
      margin: 0 10px;
    }

    .btn {
      background: #5865f2;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }

    .btn:hover {
      background: #4752c4;
    }

    .verification-results {
      margin-top: 20px;
      padding: 15px;
      border-radius: 6px;
      background: #1e1f22;
    }

    .metric {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #404249;
    }

    .metric:last-child {
      border-bottom: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¯ DiscordMessageè°ƒç”¨é“¾éªŒè¯å·¥å…·</h1>
      <p>éªŒè¯Fechatteræ˜¯å¦å®Œå…¨ä»¥DiscordMessageä¸ºä¸­å¿ƒ</p>
    </div>

    <div class="section">
      <h2>ğŸ“Š å½“å‰è°ƒç”¨é“¾æ¶æ„</h2>
      <div class="diagram">
        <div class="chain-item">Chat.vue</div>
        <span class="arrow">â†“</span>
        <div class="chain-item">discord-message-container</div>
        <span class="arrow">â†“</span>
        <div class="chain-item" style="background: #ed4245;">DiscordMessageItem.vue</div>
        <br><br>
        <div style="font-size: 14px; color: #b5bac1;">
          âœ… é›¶åŒ…è£…æ¸²æŸ“ | âœ… DiscordåŸç”Ÿæ ·å¼ | âœ… ä¸“ç”¨è¿½è¸ªç³»ç»Ÿ
        </div>
      </div>
    </div>

    <div class="section">
      <h2>ğŸ”§ éªŒè¯åŠŸèƒ½</h2>
      <button class="btn" onclick="verifyCallChain()">éªŒè¯è°ƒç”¨é“¾</button>
      <button class="btn" onclick="verifyDiscordElements()">éªŒè¯DiscordMessageå…ƒç´ </button>
      <button class="btn" onclick="verifyContainerPurity()">éªŒè¯å®¹å™¨çº¯å‡€åº¦</button>
      <button class="btn" onclick="runCompleteVerification()">å®Œæ•´éªŒè¯</button>

      <div id="verificationResults" class="verification-results" style="display: none;">
        <h3>ğŸ“‹ éªŒè¯ç»“æœ</h3>
        <div id="results"></div>
      </div>
    </div>

    <div class="section">
      <h2>ğŸ¯ DiscordMessageæ ¸å¿ƒç»„ä»¶æ£€æŸ¥</h2>
      <div class="code">
        <strong>æ ¸å¿ƒç»„ä»¶è·¯å¾„ï¼š</strong><br>
        /components/discord/DiscordMessageItem.vue<br><br>
        <strong>åŒ…å«å­ç»„ä»¶ï¼š</strong><br>
        â€¢ DiscordAvatar.vue<br>
        â€¢ DiscordMarkdown.vue<br>
        â€¢ FilePreview.vue<br>
        â€¢ TranslationPanel.vue<br>
        â€¢ ImageViewer.vue
      </div>
    </div>

    <div class="section">
      <h2>ğŸ“ˆ å®æ—¶ç›‘æ§</h2>
      <div id="liveMetrics">
        <div class="metric">
          <span>Discordå…ƒç´ æ•°é‡:</span>
          <span id="discordElementCount" class="info">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="metric">
          <span>å®¹å™¨ç±»å‹:</span>
          <span id="containerType" class="info">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="metric">
          <span>è°ƒç”¨é“¾çº¯å‡€åº¦:</span>
          <span id="chainPurity" class="info">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="metric">
          <span>DiscordMessageä¸­å¿ƒåŒ–:</span>
          <span id="discordCentered" class="info">æ£€æµ‹ä¸­...</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // éªŒè¯è°ƒç”¨é“¾
    function verifyCallChain() {
      const results = [];

      // æ£€æŸ¥Chat.vueæ˜¯å¦ä½¿ç”¨SimpleMessageList
      const chatComponents = document.querySelectorAll('.message-list, .simple-message-list, .discord-message-container');
      if (chatComponents.length > 0) {
        results.push({ type: 'success', message: `âœ… å‘ç° ${chatComponents.length} ä¸ªæ¶ˆæ¯å®¹å™¨ç»„ä»¶` });
      } else {
        results.push({ type: 'warning', message: 'âš ï¸ æœªæ‰¾åˆ°æ¶ˆæ¯å®¹å™¨ç»„ä»¶' });
      }

      // æ£€æŸ¥DiscordMessageå…ƒç´ 
      const discordMessages = document.querySelectorAll('.discord-message, [class*="discord-message"]');
      if (discordMessages.length > 0) {
        results.push({ type: 'success', message: `âœ… å‘ç° ${discordMessages.length} ä¸ªDiscordMessageå…ƒç´ ` });
      } else {
        results.push({ type: 'error', message: 'âŒ æœªæ‰¾åˆ°DiscordMessageå…ƒç´ ' });
      }

      showResults(results);
    }

    // éªŒè¯DiscordMessageå…ƒç´ 
    function verifyDiscordElements() {
      const results = [];

      // æ£€æŸ¥discord-message-container
      const container = document.querySelector('.discord-message-container');
      if (container) {
        results.push({ type: 'success', message: 'âœ… Discordæ¶ˆæ¯å®¹å™¨å­˜åœ¨' });

        // æ£€æŸ¥å®¹å™¨å†…çš„DiscordMessageæ•°é‡
        const messages = container.querySelectorAll('.discord-message, [data-message-id]');
        results.push({ type: 'info', message: `ğŸ“Š å®¹å™¨å†…æ¶ˆæ¯æ•°é‡: ${messages.length}` });

        // æ£€æŸ¥æ˜¯å¦æœ‰å…¨å±€çš„getDiscordElementsæ–¹æ³•
        if (window.messageListRef?.getDiscordElements) {
          const elementCount = window.messageListRef.getDiscordElements().size;
          results.push({ type: 'success', message: `âœ… Discordå…ƒç´ è¿½è¸ª: ${elementCount} ä¸ªå…ƒç´ ` });
        }
      } else {
        results.push({ type: 'error', message: 'âŒ Discordæ¶ˆæ¯å®¹å™¨ä¸å­˜åœ¨' });
      }

      showResults(results);
    }

    // éªŒè¯å®¹å™¨çº¯å‡€åº¦
    function verifyContainerPurity() {
      const results = [];

      // æ£€æŸ¥æ˜¯å¦æœ‰å¤šä½™çš„åŒ…è£…å±‚
      const wrappers = document.querySelectorAll('.message-wrapper, .messages-wrapper');
      if (wrappers.length === 0) {
        results.push({ type: 'success', message: 'âœ… å®¹å™¨çº¯å‡€ï¼Œæ— å¤šä½™åŒ…è£…å±‚' });
      } else {
        results.push({ type: 'warning', message: `âš ï¸ å‘ç° ${wrappers.length} ä¸ªå¯èƒ½çš„åŒ…è£…å±‚` });
      }

      // æ£€æŸ¥æ˜¯å¦ç›´æ¥æ¸²æŸ“DiscordMessageItem
      const directMessages = document.querySelectorAll('.discord-message-container > .discord-message');
      if (directMessages.length > 0) {
        results.push({ type: 'success', message: `âœ… ç›´æ¥æ¸²æŸ“DiscordMessage: ${directMessages.length} ä¸ª` });
      } else {
        results.push({ type: 'info', message: 'ğŸ“Š æ£€æŸ¥æ¸²æŸ“å±‚çº§ç»“æ„' });
      }

      showResults(results);
    }

    // å®Œæ•´éªŒè¯
    function runCompleteVerification() {
      const results = [];

      // 1. è°ƒç”¨é“¾éªŒè¯
      results.push({ type: 'info', message: 'ğŸ” å¼€å§‹å®Œæ•´DiscordMessageéªŒè¯...' });

      // 2. ç»„ä»¶å­˜åœ¨æ€§éªŒè¯
      const hasDiscordContainer = !!document.querySelector('.discord-message-container');
      const hasDiscordMessages = document.querySelectorAll('.discord-message, [data-message-id]').length > 0;

      if (hasDiscordContainer && hasDiscordMessages) {
        results.push({ type: 'success', message: 'âœ… DiscordMessageä¸­å¿ƒåŒ–æ¶æ„å®Œæ•´' });
      } else {
        results.push({ type: 'error', message: 'âŒ DiscordMessageæ¶æ„ä¸å®Œæ•´' });
      }

      // 3. æ ·å¼ç³»ç»ŸéªŒè¯
      const hasDiscordStyles = document.querySelector('style, link[href*="discord"]') ||
        getComputedStyle(document.body).getPropertyValue('--discord-bg');
      if (hasDiscordStyles) {
        results.push({ type: 'success', message: 'âœ… Discordæ ·å¼ç³»ç»ŸåŠ è½½' });
      } else {
        results.push({ type: 'warning', message: 'âš ï¸ Discordæ ·å¼ç³»ç»Ÿå¯èƒ½æœªå®Œå…¨åŠ è½½' });
      }

      // 4. è°ƒè¯•ç³»ç»ŸéªŒè¯
      if (window.messageDisplayGuarantee) {
        results.push({ type: 'success', message: 'âœ… DiscordMessageæ˜¾ç¤ºä¿è¯ç³»ç»Ÿæ´»è·ƒ' });
      } else {
        results.push({ type: 'warning', message: 'âš ï¸ æ˜¾ç¤ºä¿è¯ç³»ç»Ÿæœªæ£€æµ‹åˆ°' });
      }

      // 5. æ€§èƒ½éªŒè¯
      const messageCount = document.querySelectorAll('[data-message-id]').length;
      if (messageCount > 0) {
        results.push({ type: 'success', message: `âœ… æ´»è·ƒDiscordMessageæ•°é‡: ${messageCount}` });
      }

      results.push({ type: 'success', message: 'ğŸ‰ DiscordMessageä¸­å¿ƒåŒ–éªŒè¯å®Œæˆï¼' });

      showResults(results);
    }

    // æ˜¾ç¤ºç»“æœ
    function showResults(results) {
      const resultsDiv = document.getElementById('results');
      const container = document.getElementById('verificationResults');

      resultsDiv.innerHTML = results.map(result =>
        `<div class="${result.type}">${result.message}</div>`
      ).join('');

      container.style.display = 'block';
    }

    // å®æ—¶ç›‘æ§
    function updateLiveMetrics() {
      // Discordå…ƒç´ æ•°é‡
      const discordCount = document.querySelectorAll('.discord-message, [data-message-id]').length;
      document.getElementById('discordElementCount').textContent = discordCount;
      document.getElementById('discordElementCount').className = discordCount > 0 ? 'success' : 'warning';

      // å®¹å™¨ç±»å‹
      const hasDiscordContainer = document.querySelector('.discord-message-container');
      document.getElementById('containerType').textContent = hasDiscordContainer ? 'discord-message-container âœ…' : 'å…¶ä»–å®¹å™¨ âš ï¸';
      document.getElementById('containerType').className = hasDiscordContainer ? 'success' : 'warning';

      // è°ƒç”¨é“¾çº¯å‡€åº¦
      const wrapperCount = document.querySelectorAll('.message-wrapper, .messages-wrapper').length;
      document.getElementById('chainPurity').textContent = wrapperCount === 0 ? '100% çº¯å‡€ âœ…' : `${wrapperCount}ä¸ªåŒ…è£…å±‚ âš ï¸`;
      document.getElementById('chainPurity').className = wrapperCount === 0 ? 'success' : 'warning';

      // DiscordMessageä¸­å¿ƒåŒ–
      const isDiscordCentered = hasDiscordContainer && discordCount > 0;
      document.getElementById('discordCentered').textContent = isDiscordCentered ? 'å®Œå…¨ä¸­å¿ƒåŒ– âœ…' : 'éœ€è¦ä¼˜åŒ– âš ï¸';
      document.getElementById('discordCentered').className = isDiscordCentered ? 'success' : 'warning';
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      updateLiveMetrics();
      setInterval(updateLiveMetrics, 2000); // æ¯2ç§’æ›´æ–°ä¸€æ¬¡
    });

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒéªŒè¯
    setTimeout(() => {
      runCompleteVerification();
    }, 1000);
  </script>
</body>

</html>