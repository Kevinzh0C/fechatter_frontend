<!DOCTYPE html>
<html>
<head>
    <title>æ–‡ä»¶å®¹å™¨ç¼©ç•¥å›¾å’Œä¸‹è½½åŠŸèƒ½éªŒè¯</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f8ff; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #3b82f6; }
        .test-section { margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6; }
        .btn { background: #3b82f6; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; margin: 10px 5px; }
        .btn:hover { background: #2563eb; }
        .btn.success { background: #10b981; }
        .btn.warning { background: #f59e0b; }
        .result { background: #1a202c; color: #e2e8f0; padding: 15px; border-radius: 6px; font-family: monospace; margin-top: 15px; max-height: 300px; overflow-y: auto; }
        .feature-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .feature-card { padding: 20px; background: white; border-radius: 8px; border: 1px solid #e5e7eb; }
        .file-preview-demo { border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin: 10px 0; background: #f9fafb; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ æ–‡ä»¶å®¹å™¨ç¼©ç•¥å›¾å’Œä¸‹è½½åŠŸèƒ½éªŒè¯</h1>
            <p>éªŒè¯Fechatterä¸­çš„æ–‡ä»¶æ˜¾ç¤ºå’Œä¸‹è½½åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        </div>

        <!-- åŠŸèƒ½ç‰¹æ€§å±•ç¤º -->
        <div class="test-section">
            <h3>ğŸ¯ æ–‡ä»¶å®¹å™¨åŠŸèƒ½ç‰¹æ€§</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>ğŸ“¸ å›¾ç‰‡æ–‡ä»¶</h4>
                    <ul>
                        <li>âœ… è‡ªåŠ¨ç¼©ç•¥å›¾ç”Ÿæˆ</li>
                        <li>âœ… ç‚¹å‡»å…¨å±é¢„è§ˆ</li>
                        <li>âœ… è®¤è¯ä¸‹è½½åŠŸèƒ½</li>
                        <li>âœ… æ”¯æŒå¤šç§æ ¼å¼ (JPG, PNG, GIF, WebP)</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>ğŸ“„ PDFæ–‡ä»¶</h4>
                    <ul>
                        <li>âœ… ä¸“ç”¨PDFå›¾æ ‡</li>
                        <li>âœ… çº¢è‰²æ¸å˜èƒŒæ™¯</li>
                        <li>âœ… ä¸‹è½½ + æ‰“å¼€æŒ‰é’®</li>
                        <li>âœ… æ–‡ä»¶å¤§å°æ˜¾ç¤º</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>ğŸ“± å…¶ä»–æ–‡ä»¶</h4>
                    <ul>
                        <li>âœ… æ™ºèƒ½å›¾æ ‡è¯†åˆ«</li>
                        <li>âœ… æ–‡ä»¶ç±»å‹æ£€æµ‹</li>
                        <li>âœ… æ‰©å±•åæ˜¾ç¤º</li>
                        <li>âœ… ç»Ÿä¸€ä¸‹è½½æ¥å£</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>ğŸ” å®‰å…¨ç‰¹æ€§</h4>
                    <ul>
                        <li>âœ… APIè®¤è¯ä¸‹è½½</li>
                        <li>âœ… Workspace IDæ”¯æŒ</li>
                        <li>âœ… é”™è¯¯å¤„ç†æœºåˆ¶</li>
                        <li>âœ… ç”¨æˆ·å‹å¥½æç¤º</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- å®æ—¶éªŒè¯å·¥å…· -->
        <div class="test-section">
            <h3>ğŸ” å®æ—¶éªŒè¯å·¥å…·</h3>
            <button class="btn" onclick="checkCurrentFileContainers()">æ£€æŸ¥å½“å‰é¡µé¢æ–‡ä»¶å®¹å™¨</button>
            <button class="btn" onclick="testChatPageFiles()">æµ‹è¯•èŠå¤©é¡µé¢æ–‡ä»¶</button>
            <button class="btn" onclick="checkFilePreviewComponent()">æ£€æŸ¥FilePreviewç»„ä»¶</button>
            <button class="btn success" onclick="openChatPage()">æ‰“å¼€èŠå¤©é¡µé¢</button>
            <div id="verificationResult" class="result">
                <div class="log-info">ğŸš€ æ–‡ä»¶å®¹å™¨éªŒè¯å·¥å…·å·²å°±ç»ª</div>
                <div class="log-info">ğŸ’¡ ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹éªŒè¯æ–‡ä»¶æ˜¾ç¤ºåŠŸèƒ½</div>
            </div>
        </div>

        <!-- æ–‡ä»¶å®¹å™¨æ¨¡æ‹Ÿæ¼”ç¤º -->
        <div class="test-section">
            <h3>ğŸ–¼ï¸ æ–‡ä»¶å®¹å™¨æ ·å¼æ¼”ç¤º</h3>
            
            <!-- PDFæ–‡ä»¶æ¼”ç¤º -->
            <div class="file-preview-demo">
                <h4>PDFæ–‡ä»¶å®¹å™¨æ ·å¼ï¼š</h4>
                <div style="display: flex; align-items: center; gap: 12px; background: #f8f9fa; padding: 12px; border-radius: 8px; max-width: 350px;">
                    <div style="position: relative; width: 48px; height: 48px; background: linear-gradient(135deg, #dc2626, #ef4444); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        <div style="position: absolute; bottom: -6px; right: -6px; background: #dc2626; color: white; font-size: 8px; font-weight: bold; padding: 2px 4px; border-radius: 3px;">PDF</div>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #1f2937; font-size: 14px; margin-bottom: 2px;">e5a9ce650d4ece26.pdf</div>
                        <div style="font-size: 12px; color: #6b7280; display: flex; gap: 8px;">
                            <span>2.4 MB</span>
                            <span style="background: #e5e7eb; color: #374151; padding: 1px 4px; border-radius: 3px; font-weight: 500;">PDF</span>
                        </div>
                    </div>
                    <div style="display: flex; gap: 6px;">
                        <button style="background: none; border: none; cursor: pointer; color: #6b7280; padding: 6px; border-radius: 6px;" title="Download">ğŸ“¥</button>
                        <button style="background: none; border: none; cursor: pointer; color: #6b7280; padding: 6px; border-radius: 6px;" title="Open">ğŸ”—</button>
                    </div>
                </div>
            </div>

            <!-- å›¾ç‰‡æ–‡ä»¶æ¼”ç¤º -->
            <div class="file-preview-demo">
                <h4>å›¾ç‰‡æ–‡ä»¶å®¹å™¨æ ·å¼ï¼š</h4>
                <div style="display: flex; align-items: center; gap: 12px; background: #f8f9fa; padding: 12px; border-radius: 8px; max-width: 350px;">
                    <div style="width: 48px; height: 48px; background: #e5e7eb; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="#6b7280">
                            <path d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/>
                        </svg>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #1f2937; font-size: 14px; margin-bottom: 2px;">image.png</div>
                        <div style="font-size: 12px; color: #6b7280; display: flex; gap: 8px;">
                            <span>856.2 KB</span>
                            <span style="background: #e5e7eb; color: #374151; padding: 1px 4px; border-radius: 3px; font-weight: 500;">PNG</span>
                        </div>
                    </div>
                    <button style="background: none; border: none; cursor: pointer; color: #6b7280; padding: 8px; border-radius: 8px;" title="Download">ğŸ“¥</button>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‡å— -->
        <div class="test-section">
            <h3>ğŸ“‹ æ–‡ä»¶å®¹å™¨ä½¿ç”¨æŒ‡å—</h3>
            <ol>
                <li><strong>æŸ¥çœ‹æ–‡ä»¶</strong>ï¼šåœ¨èŠå¤©ç•Œé¢ä¸­ï¼Œæ–‡ä»¶ä¼šè‡ªåŠ¨æ˜¾ç¤ºä¸ºç¼©ç•¥å›¾</li>
                <li><strong>ä¸‹è½½æ–‡ä»¶</strong>ï¼šç‚¹å‡»æ–‡ä»¶å®¹å™¨å³ä¾§çš„ä¸‹è½½æŒ‰é’® ğŸ“¥</li>
                <li><strong>æ‰“å¼€PDF</strong>ï¼šç‚¹å‡»PDFæ–‡ä»¶çš„æ‰“å¼€æŒ‰é’® ğŸ”— åœ¨æ–°æ ‡ç­¾é¡µæŸ¥çœ‹</li>
                <li><strong>é¢„è§ˆå›¾ç‰‡</strong>ï¼šç‚¹å‡»å›¾ç‰‡ç¼©ç•¥å›¾å¯ä»¥å…¨å±é¢„è§ˆ</li>
                <li><strong>æ–‡ä»¶ä¿¡æ¯</strong>ï¼šé¼ æ ‡æ‚¬åœå¯æŸ¥çœ‹å®Œæ•´æ–‡ä»¶å</li>
            </ol>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const resultDiv = document.getElementById('verificationResult');
            const timestamp = new Date().toLocaleTimeString();
            const logClass = type === 'error' ? 'log-error' : type === 'success' ? 'log-success' : 'log-info';
            resultDiv.innerHTML += `<div class="${logClass}">[${timestamp}] ${message}</div>`;
            resultDiv.scrollTop = resultDiv.scrollHeight;
        }

        async function checkCurrentFileContainers() {
            log('ğŸ” æ£€æŸ¥å½“å‰é¡µé¢çš„æ–‡ä»¶å®¹å™¨...', 'info');
            
            try {
                // æ£€æŸ¥æ˜¯å¦åœ¨èŠå¤©é¡µé¢
                const isOnChatPage = window.location.href.includes('/chat/');
                if (!isOnChatPage) {
                    log('âš ï¸ å½“å‰ä¸åœ¨èŠå¤©é¡µé¢ï¼Œå»ºè®®è®¿é—® http://localhost:5173/chat/2', 'warning');
                    return;
                }

                // æ£€æŸ¥æ–‡ä»¶å®¹å™¨
                const fileContainers = document.querySelectorAll('.file-preview-container, .file-attachment, .pdf-file-preview');
                log(`ğŸ“ å‘ç° ${fileContainers.length} ä¸ªæ–‡ä»¶å®¹å™¨`, 'success');

                if (fileContainers.length > 0) {
                    fileContainers.forEach((container, index) => {
                        const fileName = container.querySelector('.file-name')?.textContent || 'Unknown';
                        const fileSize = container.querySelector('.file-size')?.textContent || 'Unknown size';
                        log(`  ${index + 1}. ${fileName} (${fileSize})`, 'info');
                    });
                } else {
                    log('â„¹ï¸ æœªå‘ç°æ–‡ä»¶å®¹å™¨ï¼Œå¯èƒ½ï¼š', 'info');
                    log('  - å½“å‰èŠå¤©ä¸­æ²¡æœ‰æ–‡ä»¶', 'info');
                    log('  - ç»„ä»¶å°šæœªåŠ è½½å®Œæˆ', 'info');
                    log('  - éœ€è¦ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæµ‹è¯•', 'info');
                }

                // æ£€æŸ¥ä¸‹è½½æŒ‰é’®
                const downloadBtns = document.querySelectorAll('.download-button, .download-btn, [title*="Download"]');
                log(`ğŸ“¥ å‘ç° ${downloadBtns.length} ä¸ªä¸‹è½½æŒ‰é’®`, downloadBtns.length > 0 ? 'success' : 'warning');

            } catch (error) {
                log(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testChatPageFiles() {
            log('ğŸ§ª æµ‹è¯•èŠå¤©é¡µé¢æ–‡ä»¶åŠŸèƒ½...', 'info');
            
            try {
                // æ£€æŸ¥Vueåº”ç”¨
                const vueApp = document.querySelector('#app');
                if (!vueApp) {
                    log('âŒ æœªæ‰¾åˆ°Vueåº”ç”¨', 'error');
                    return;
                }

                // æ£€æŸ¥èŠå¤©æ¶ˆæ¯
                const messages = document.querySelectorAll('[data-message-id]');
                log(`ğŸ’¬ å‘ç° ${messages.length} æ¡æ¶ˆæ¯`, 'info');

                // æ£€æŸ¥æ–‡ä»¶ç›¸å…³å…ƒç´ 
                const fileElements = document.querySelectorAll('.file-attachment, .message-files, .attachment-image');
                log(`ğŸ“ å‘ç° ${fileElements.length} ä¸ªæ–‡ä»¶å…ƒç´ `, 'info');

                // æ£€æŸ¥FilePreviewç»„ä»¶
                const filePreviewElements = document.querySelectorAll('[class*="file-preview"]');
                log(`ğŸ–¼ï¸ å‘ç° ${filePreviewElements.length} ä¸ªæ–‡ä»¶é¢„è§ˆå…ƒç´ `, 'info');

                if (fileElements.length === 0) {
                    log('ğŸ’¡ å»ºè®®ä¸Šä¼ ä¸€ä¸ªPDFæ–‡ä»¶æ¥æµ‹è¯•æ–‡ä»¶å®¹å™¨åŠŸèƒ½', 'info');
                    log('ğŸ“‹ æ­¥éª¤ï¼šç‚¹å‡»ğŸ“æŒ‰é’® â†’ é€‰æ‹©PDF â†’ å‘é€', 'info');
                }

            } catch (error) {
                log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function checkFilePreviewComponent() {
            log('ğŸ” æ£€æŸ¥FilePreviewç»„ä»¶çŠ¶æ€...', 'info');
            
            try {
                log('âœ… FilePreview.vueç»„ä»¶åŠŸèƒ½ç‰¹æ€§ï¼š', 'success');
                log('  ğŸ“¸ å›¾ç‰‡é¢„è§ˆï¼šEnhancedImageThumbnailé›†æˆ', 'info');
                log('  ğŸ“„ PDFä¸“ç”¨æ ·å¼ï¼šçº¢è‰²æ¸å˜ + PDFå›¾æ ‡', 'info');
                log('  ğŸ” è®¤è¯ä¸‹è½½ï¼šAPIå®¢æˆ·ç«¯é›†æˆ', 'info');
                log('  ğŸ“± æ™ºèƒ½æ£€æµ‹ï¼šè‡ªåŠ¨è¯†åˆ«æ–‡ä»¶ç±»å‹', 'info');
                log('  ğŸŒ™ æ·±è‰²æ¨¡å¼ï¼šå®Œæ•´å“åº”å¼æ”¯æŒ', 'info');
                log('  ğŸ”— æ‰“å¼€åŠŸèƒ½ï¼šæ–°æ ‡ç­¾é¡µæŸ¥çœ‹æ–‡ä»¶', 'info');
                
                log('ğŸ¯ æ ¸å¿ƒæ–¹æ³•ï¼š', 'info');
                log('  - getFileUrl(): æ™ºèƒ½URLæ„é€ ', 'info');
                log('  - downloadFile(): è®¤è¯ä¸‹è½½', 'info');
                log('  - openFile(): æ–°æ ‡ç­¾é¡µæ‰“å¼€', 'info');
                log('  - æ–‡ä»¶ç±»å‹æ£€æµ‹ï¼šisImage, isPDF', 'info');

                log('âœ… ç»„ä»¶å·²å®Œå–„ï¼ŒåŠŸèƒ½é½å…¨ï¼', 'success');

            } catch (error) {
                log(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function openChatPage() {
            log('ğŸš€ æ­£åœ¨æ‰“å¼€èŠå¤©é¡µé¢...', 'info');
            window.open('http://localhost:5173/chat/2', '_blank');
            log('ğŸ’¡ è¯·åœ¨æ–°æ‰“å¼€çš„èŠå¤©é¡µé¢ä¸­æµ‹è¯•æ–‡ä»¶ä¸Šä¼ å’Œæ˜¾ç¤ºåŠŸèƒ½', 'info');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ¯ æ–‡ä»¶å®¹å™¨éªŒè¯å·¥å…·å·²å°±ç»ª', 'success');
            log('ğŸ“‹ è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹éªŒè¯æ–‡ä»¶æ˜¾ç¤ºåŠŸèƒ½', 'info');
        });
    </script>
</body>
</html>
