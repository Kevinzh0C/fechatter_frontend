<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ” æ•°æ®ä¼ è¾“æ–­ç‚¹è¯Šæ–­å·¥å…·</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    .code-block {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 6px;
      padding: 12px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 12px;
      overflow-x: auto;
    }

    .diagnostic-card {
      transition: all 0.2s ease;
    }

    .diagnostic-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen">
  <!-- Header -->
  <div class="bg-gradient-to-r from-red-500 to-orange-500 text-white py-6">
    <div class="max-w-6xl mx-auto px-6">
      <h1 class="text-3xl font-bold mb-2">ğŸ” æ•°æ®ä¼ è¾“æ–­ç‚¹è¯Šæ–­å·¥å…·</h1>
      <p class="text-xl opacity-90">è¯†åˆ«å’Œä¿®å¤ç”¨æˆ·åæ•°æ®ä¼ è¾“ä¸­çš„æ–­ç‚¹é—®é¢˜</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-6xl mx-auto px-6 py-8">

    <!-- Quick Diagnostic -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
        <span class="bg-red-100 text-red-600 rounded-full p-2 mr-3">
          ğŸš¨
        </span>
        å¿«é€Ÿè¯Šæ–­æŒ‡å—
      </h2>

      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h3 class="font-semibold text-gray-900 mb-3">ğŸ” å¦‚ä½•ä½¿ç”¨è¯Šæ–­å·¥å…·</h3>
          <ol class="space-y-2 text-sm text-gray-700">
            <li><strong>1.</strong> åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªæ¶ˆæ¯å¤´åƒå³ä¸Šè§’ä¼šå‡ºç°é»„è‰²ğŸ”å›¾æ ‡</li>
            <li><strong>2.</strong> åŒå‡»å¤´åƒæˆ–ç‚¹å‡»ğŸ”å›¾æ ‡æ˜¾ç¤ºæ•°æ®æ–­ç‚¹é¢æ¿</li>
            <li><strong>3.</strong> æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—äº†è§£è¯¦ç»†çš„æ•°æ®æºè¿½è¸ª</li>
            <li><strong>4.</strong> å¯¹æ¯”"Rawæ•°æ®"ä¸"æ˜¾ç¤ºç»“æœ"æ‰¾åˆ°æ–­ç‚¹</li>
          </ol>
        </div>

        <div>
          <h3 class="font-semibold text-gray-900 mb-3">âš ï¸ å¸¸è§æ•°æ®æ–­ç‚¹ç±»å‹</h3>
          <div class="space-y-2 text-sm">
            <div class="flex items-start space-x-2">
              <span class="text-red-500">âŒ</span>
              <span>å®Œæ•´ç¼ºå¤±ï¼šæ‰€æœ‰ç”¨æˆ·åå­—æ®µéƒ½ä¸ºnull</span>
            </div>
            <div class="flex items-start space-x-2">
              <span class="text-yellow-500">âš ï¸</span>
              <span>éƒ¨åˆ†ç¼ºå¤±ï¼šåªæœ‰fallbackæ•°æ®</span>
            </div>
            <div class="flex items-start space-x-2">
              <span class="text-blue-500">ğŸ”„</span>
              <span>æ•°æ®æ˜ å°„é”™è¯¯ï¼šå­—æ®µåä¸åŒ¹é…</span>
            </div>
            <div class="flex items-start space-x-2">
              <span class="text-purple-500">ğŸ•</span>
              <span>æ—¶åºé—®é¢˜ï¼šæ•°æ®å¼‚æ­¥åŠ è½½æ—¶æœº</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Data Structure Analysis -->
    <div class="grid md:grid-cols-2 gap-6 mb-8">
      <!-- Expected Structure -->
      <div class="bg-white rounded-xl shadow-lg p-6 diagnostic-card">
        <h3 class="text-xl font-bold text-green-600 mb-4">âœ… æœŸæœ›çš„æ•°æ®ç»“æ„</h3>
        <div class="code-block">
          <pre>{
  "id": 123,
  "sender_id": 456,
  "content": "æ¶ˆæ¯å†…å®¹",
  "created_at": "2024-01-01T12:00:00Z",
  
  // æ–¹å¼1: å®Œæ•´senderå¯¹è±¡
  "sender": {
    "id": 456,
    "fullname": "å¼ ä¸‰",
    "username": "zhangsan", 
    "avatar_url": "https://...",
    "is_online": true
  },
  
  // æ–¹å¼2: å¹³é“ºå­—æ®µ
  "sender_name": "å¼ ä¸‰",
  "sender_avatar": "https://..."
}</pre>
        </div>
      </div>

      <!-- Problem Structure -->
      <div class="bg-white rounded-xl shadow-lg p-6 diagnostic-card">
        <h3 class="text-xl font-bold text-red-600 mb-4">âŒ é—®é¢˜æ•°æ®ç»“æ„</h3>
        <div class="code-block">
          <pre>{
  "id": 123,
  "sender_id": 456,
  "content": "æ¶ˆæ¯å†…å®¹",
  "created_at": "2024-01-01T12:00:00Z",
  
  // é—®é¢˜1: senderå¯¹è±¡ä¸ºnull
  "sender": null,
  
  // é—®é¢˜2: ç¼ºå°‘sender_name
  "sender_name": null,
  
  // é—®é¢˜3: å­—æ®µåé”™è¯¯
  "user_name": "å¼ ä¸‰", // åº”è¯¥æ˜¯sender_name
  "avatar": "https://..." // åº”è¯¥æ˜¯sender_avatar
}</pre>
        </div>
      </div>
    </div>

    <!-- Debugging Steps -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">ğŸ› ï¸ æ–­ç‚¹è°ƒè¯•æ­¥éª¤</h2>

      <div class="space-y-6">
        <!-- Step 1 -->
        <div class="border-l-4 border-blue-500 pl-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">ç¬¬1æ­¥ï¼šæ£€æŸ¥åç«¯APIå“åº”</h3>
          <p class="text-gray-600 mb-3">åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Networkæ ‡ç­¾é¡µä¸­æŸ¥çœ‹æ¶ˆæ¯APIçš„åŸå§‹å“åº”</p>
          <div class="code-block">
            <pre>// æ£€æŸ¥ä»¥ä¸‹APIç«¯ç‚¹çš„å“åº”æ ¼å¼ï¼š
GET /api/chats/{chat_id}/messages
POST /api/chats/{chat_id}/messages
WebSocket /ws æ¶ˆæ¯äº‹ä»¶</pre>
          </div>
        </div>

        <!-- Step 2 -->
        <div class="border-l-4 border-green-500 pl-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">ç¬¬2æ­¥ï¼šéªŒè¯å‰ç«¯æ•°æ®æ¥æ”¶</h3>
          <p class="text-gray-600 mb-3">åœ¨ChatService.tsä¸­æ·»åŠ æ—¥å¿—éªŒè¯æ•°æ®æ¥æ”¶æ­£ç¡®æ€§</p>
          <div class="code-block">
            <pre>// åœ¨ChatService.tsä¸­æ·»åŠ ï¼š
console.log('ğŸ” APIå“åº”åŸå§‹æ•°æ®:', response.data);
console.log('ğŸ” æ¶ˆæ¯åˆ—è¡¨:', response.data.messages);</pre>
          </div>
        </div>

        <!-- Step 3 -->
        <div class="border-l-4 border-yellow-500 pl-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">ç¬¬3æ­¥ï¼šæ£€æŸ¥Storeæ•°æ®å­˜å‚¨</h3>
          <p class="text-gray-600 mb-3">éªŒè¯chatStoreä¸­çš„æ¶ˆæ¯æ•°æ®æ˜¯å¦æ­£ç¡®å­˜å‚¨</p>
          <div class="code-block">
            <pre>// åœ¨chatStoreä¸­æ·»åŠ ï¼š
console.log('ğŸ” Storeä¸­çš„æ¶ˆæ¯:', this.messages);
console.log('ğŸ” ç‰¹å®šæ¶ˆæ¯:', this.messages.find(m => m.id === messageId));</pre>
          </div>
        </div>

        <!-- Step 4 -->
        <div class="border-l-4 border-purple-500 pl-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">ç¬¬4æ­¥ï¼šç»„ä»¶PropséªŒè¯</h3>
          <p class="text-gray-600 mb-3">ä½¿ç”¨å†…ç½®çš„è¯Šæ–­å·¥å…·æ£€æŸ¥ç»„ä»¶æ¥æ”¶åˆ°çš„æ•°æ®</p>
          <div class="code-block">
            <pre>// åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼š
1. åŒå‡»æ¶ˆæ¯å¤´åƒæ˜¾ç¤ºè¯Šæ–­é¢æ¿
2. æŸ¥çœ‹æ§åˆ¶å°ä¸­çš„æ•°æ®æºè¿½è¸ªæ—¥å¿—
3. å¯¹æ¯”æœŸæœ›å€¼ä¸å®é™…å€¼</pre>
          </div>
        </div>
      </div>
    </div>

    <!-- Common Solutions -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">ğŸ’¡ å¸¸è§è§£å†³æ–¹æ¡ˆ</h2>

      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h3 class="text-lg font-semibold text-red-600 mb-3">åç«¯ä¿®å¤</h3>
          <div class="space-y-3 text-sm">
            <div class="p-3 bg-red-50 rounded-lg">
              <strong>é—®é¢˜ï¼š</strong> APIå“åº”ç¼ºå°‘ç”¨æˆ·ä¿¡æ¯<br>
              <strong>è§£å†³ï¼š</strong> ç¡®ä¿JOINæŸ¥è¯¢åŒ…å«userè¡¨
            </div>
            <div class="p-3 bg-red-50 rounded-lg">
              <strong>é—®é¢˜ï¼š</strong> å­—æ®µåä¸ä¸€è‡´<br>
              <strong>è§£å†³ï¼š</strong> ç»Ÿä¸€ä½¿ç”¨sender_name/sender_avatar
            </div>
            <div class="p-3 bg-red-50 rounded-lg">
              <strong>é—®é¢˜ï¼š</strong> åºåˆ—åŒ–æ—¶ä¸¢å¤±æ•°æ®<br>
              <strong>è§£å†³ï¼š</strong> æ£€æŸ¥Serializeré…ç½®
            </div>
          </div>
        </div>

        <div>
          <h3 class="text-lg font-semibold text-blue-600 mb-3">å‰ç«¯ä¿®å¤</h3>
          <div class="space-y-3 text-sm">
            <div class="p-3 bg-blue-50 rounded-lg">
              <strong>é—®é¢˜ï¼š</strong> æ•°æ®æ˜ å°„é”™è¯¯<br>
              <strong>è§£å†³ï¼š</strong> æ›´æ–°DiscordMessageItem.vueçš„å­—æ®µæ˜ å°„
            </div>
            <div class="p-3 bg-blue-50 rounded-lg">
              <strong>é—®é¢˜ï¼š</strong> å¼‚æ­¥åŠ è½½æ—¶åº<br>
              <strong>è§£å†³ï¼š</strong> æ·»åŠ loadingçŠ¶æ€å’Œæ•°æ®å°±ç»ªæ£€æŸ¥
            </div>
            <div class="p-3 bg-blue-50 rounded-lg">
              <strong>é—®é¢˜ï¼š</strong> ç¼“å­˜æ•°æ®è¿‡æœŸ<br>
              <strong>è§£å†³ï¼š</strong> å®ç°æ•°æ®åˆ·æ–°æœºåˆ¶
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Debug Console -->
    <div class="bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">ğŸ–¥ï¸ å®æ—¶è°ƒè¯•æ§åˆ¶å°</h2>
      <div class="bg-gray-900 text-green-400 rounded-lg p-4 font-mono text-sm">
        <div id="debug-output">
          <div class="text-yellow-400"># Fechatter æ•°æ®ä¼ è¾“æ–­ç‚¹è¯Šæ–­æ§åˆ¶å°</div>
          <div class="text-gray-400"># åœ¨èŠå¤©ç•Œé¢ä¸­åŒå‡»æ¶ˆæ¯å¤´åƒå¼€å§‹è¯Šæ–­...</div>
          <div class="text-gray-400"># æˆ–æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—</div>
          <div class="mt-4">
            <span class="text-blue-400">$</span> <span class="blinking-cursor">_</span>
          </div>
        </div>
      </div>

      <div class="mt-4 flex space-x-4">
        <button onclick="clearDebugOutput()"
          class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
          æ¸…ç©ºæ—¥å¿—
        </button>
        <button onclick="exportDebugData()"
          class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
          å¯¼å‡ºè¯Šæ–­æ•°æ®
        </button>
        <button onclick="window.open('/chat', '_blank')"
          class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
          æ‰“å¼€èŠå¤©ç•Œé¢æµ‹è¯•
        </button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="bg-gray-800 text-white py-6 mt-12">
    <div class="max-w-6xl mx-auto px-6 text-center">
      <p class="text-lg font-semibold mb-2">ğŸ” Fechatter æ•°æ®ä¼ è¾“æ–­ç‚¹è¯Šæ–­å·¥å…·</p>
      <p class="text-gray-400">
        å®æ—¶è¯†åˆ«å’Œä¿®å¤ç”¨æˆ·åæ˜¾ç¤ºæ•°æ®ä¼ è¾“ä¸­çš„æ–­ç‚¹é—®é¢˜
      </p>
    </div>
  </div>

  <script>
    // Mock debug functionality
    function clearDebugOutput() {
      const output = document.getElementById('debug-output');
      output.innerHTML = `
                <div class="text-yellow-400"># æ§åˆ¶å°å·²æ¸…ç©º</div>
                <div class="text-gray-400"># å‡†å¤‡æ¥æ”¶æ–°çš„è¯Šæ–­æ•°æ®...</div>
                <div class="mt-4">
                    <span class="text-blue-400">$</span> <span class="blinking-cursor">_</span>
                </div>
            `;
    }

    function exportDebugData() {
      const debugData = {
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        url: window.location.href,
        message: 'æ•°æ®ä¼ è¾“æ–­ç‚¹è¯Šæ–­æŠ¥å‘Šå·²å‡†å¤‡å°±ç»ª'
      };

      const blob = new Blob([JSON.stringify(debugData, null, 2)], {
        type: 'application/json'
      });

      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `fechatter-debug-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);

      addDebugLine('ğŸ“„ è¯Šæ–­æ•°æ®å·²å¯¼å‡º');
    }

    function addDebugLine(message) {
      const output = document.getElementById('debug-output');
      const timestamp = new Date().toLocaleTimeString();
      output.innerHTML += `<div class="text-green-400">[${timestamp}] ${message}</div>`;
      output.scrollTop = output.scrollHeight;
    }

    // Simulate real-time debug messages
    setInterval(() => {
      if (Math.random() < 0.1) {
        const messages = [
          'âœ… ç›‘å¬æ¶ˆæ¯æ•°æ®ä¼ è¾“...',
          'ğŸ” æ‰«ææ•°æ®æ–­ç‚¹...',
          'ğŸ“Š åˆ†æç”¨æˆ·åæ•°æ®æº...',
          'ğŸ”— æ£€æŸ¥APIå“åº”æ ¼å¼...'
        ];
        addDebugLine(messages[Math.floor(Math.random() * messages.length)]);
      }
    }, 3000);

    // Blinking cursor animation
    setInterval(() => {
      const cursor = document.querySelector('.blinking-cursor');
      if (cursor) {
        cursor.style.opacity = cursor.style.opacity === '0' ? '1' : '0';
      }
    }, 500);
  </script>
</body>

</html>