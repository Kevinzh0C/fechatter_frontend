<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ” CSS & DOM è¯Šæ–­å·¥å…·</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 20px;
      background: #f5f7fa;
    }

    .diagnostic-panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 10px 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .status-good {
      color: #10b981;
    }

    .status-warning {
      color: #f59e0b;
    }

    .status-error {
      color: #ef4444;
    }

    .code-block {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      padding: 12px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
      margin: 8px 0;
    }

    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }

    button:hover {
      background: #4f46e5;
    }

    .highlight {
      background: #fef3c7;
      padding: 2px 4px;
    }

    .section {
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 15px;
      margin-bottom: 15px;
    }
  </style>
</head>

<body>
  <h1>ğŸ” CSS & DOM è¯Šæ–­å·¥å…·</h1>
  <p>è¯Šæ–­Fechatteræ¶ˆæ¯å†…å®¹ä¸å¯è§é—®é¢˜</p>

  <div class="diagnostic-panel">
    <button onclick="runFullDiagnostic()">ğŸš€ è¿è¡Œå®Œæ•´è¯Šæ–­</button>
    <button onclick="checkMessageElements()">ğŸ“‹ æ£€æŸ¥æ¶ˆæ¯å…ƒç´ </button>
    <button onclick="analyzeCSSStyles()">ğŸ¨ åˆ†æCSSæ ·å¼</button>
    <button onclick="checkElementVisibility()">ğŸ‘ï¸ æ£€æŸ¥å…ƒç´ å¯è§æ€§</button>
    <button onclick="analyzeContainerStructure()">ğŸ“ åˆ†æå®¹å™¨ç»“æ„</button>
    <button onclick="generateFixSuggestions()">ğŸ”§ ç”Ÿæˆä¿®å¤å»ºè®®</button>
  </div>

  <div id="results"></div>

  <script>
    async function runFullDiagnostic() {
      const results = document.getElementById('results');
      results.innerHTML = '<div class="diagnostic-panel"><h2>ğŸš€ å¼€å§‹å®Œæ•´è¯Šæ–­...</h2></div>';

      await new Promise(resolve => setTimeout(resolve, 500));

      const diagnostics = [
        checkMessageElements,
        analyzeCSSStyles,
        checkElementVisibility,
        analyzeContainerStructure,
        generateFixSuggestions
      ];

      for (const diagnostic of diagnostics) {
        try {
          await diagnostic();
          await new Promise(resolve => setTimeout(resolve, 200));
        } catch (error) {
          appendResult(`<div class="status-error">âŒ è¯Šæ–­é”™è¯¯: ${error.message}</div>`);
        }
      }

      appendResult('<div class="diagnostic-panel"><h2>âœ… è¯Šæ–­å®Œæˆï¼</h2></div>');
    }

    async function checkMessageElements() {
      appendResult('<div class="diagnostic-panel section"><h3>ğŸ“‹ æ£€æŸ¥æ¶ˆæ¯å…ƒç´ </h3>');

      const messageItems = document.querySelectorAll('[data-message-id]');
      appendResult(`<p>æ‰¾åˆ° <span class="highlight">${messageItems.length}</span> ä¸ªæ¶ˆæ¯å…ƒç´ </p>`);

      if (messageItems.length === 0) {
        appendResult('<p class="status-error">âŒ æœªæ‰¾åˆ°ä»»ä½•æ¶ˆæ¯å…ƒç´ ï¼è¿™æ˜¯ä¸»è¦é—®é¢˜ã€‚</p>');

        // æ£€æŸ¥å¯èƒ½çš„å®¹å™¨
        const containers = [
          '.simple-message-list',
          '.messages-wrapper',
          '.message-wrapper',
          '.message-item'
        ];

        for (const selector of containers) {
          const elements = document.querySelectorAll(selector);
          appendResult(`<p>å®¹å™¨ ${selector}: ${elements.length} ä¸ª</p>`);
        }

        appendResult('</div>');
        return;
      }

      // åˆ†æå‰3ä¸ªæ¶ˆæ¯å…ƒç´ 
      for (let i = 0; i < Math.min(3, messageItems.length); i++) {
        const item = messageItems[i];
        const messageId = item.getAttribute('data-message-id');

        appendResult(`<div class="code-block">
<strong>æ¶ˆæ¯ ${messageId}:</strong>
â€¢ å…ƒç´ å­˜åœ¨: âœ…
â€¢ ç±»å: ${item.className}
â€¢ å­å…ƒç´ æ•°é‡: ${item.children.length}
â€¢ æ˜¾ç¤ºçŠ¶æ€: ${getComputedStyle(item).display}
â€¢ å¯è§æ€§: ${getComputedStyle(item).visibility}
â€¢ é€æ˜åº¦: ${getComputedStyle(item).opacity}
â€¢ ä½ç½®: ${getComputedStyle(item).position}
                </div>`);

        // æ£€æŸ¥æ¶ˆæ¯æ–‡æœ¬å…ƒç´ 
        const textElement = item.querySelector('.message-text');
        if (textElement) {
          const textContent = textElement.textContent || textElement.innerHTML;
          appendResult(`<div class="code-block">
<strong>æ¶ˆæ¯æ–‡æœ¬å…ƒç´ :</strong>
â€¢ å†…å®¹é•¿åº¦: ${textContent.length} å­—ç¬¦
â€¢ å†…å®¹é¢„è§ˆ: "${textContent.substring(0, 50)}..."
â€¢ æ˜¾ç¤ºçŠ¶æ€: ${getComputedStyle(textElement).display}
â€¢ é¢œè‰²: ${getComputedStyle(textElement).color}
â€¢ å­—ä½“å¤§å°: ${getComputedStyle(textElement).fontSize}
â€¢ è¡Œé«˜: ${getComputedStyle(textElement).lineHeight}
                    </div>`);
        } else {
          appendResult('<p class="status-error">âŒ æœªæ‰¾åˆ° .message-text å…ƒç´ </p>');
        }
      }

      appendResult('</div>');
    }

    async function analyzeCSSStyles() {
      appendResult('<div class="diagnostic-panel section"><h3>ğŸ¨ åˆ†æCSSæ ·å¼</h3>');

      const criticalSelectors = [
        '.simple-message-list',
        '.messages-wrapper',
        '.message-item',
        '.message-content',
        '.message-text'
      ];

      for (const selector of criticalSelectors) {
        const elements = document.querySelectorAll(selector);
        if (elements.length > 0) {
          const element = elements[0];
          const styles = getComputedStyle(element);

          appendResult(`<div class="code-block">
<strong>${selector} (${elements.length}ä¸ª):</strong>
â€¢ display: ${styles.display}
â€¢ visibility: ${styles.visibility}
â€¢ opacity: ${styles.opacity}
â€¢ position: ${styles.position}
â€¢ z-index: ${styles.zIndex}
â€¢ width: ${styles.width}
â€¢ height: ${styles.height}
â€¢ overflow: ${styles.overflow}
â€¢ color: ${styles.color}
â€¢ background: ${styles.backgroundColor}
â€¢ transform: ${styles.transform}
                    </div>`);

          // æ£€æŸ¥æ½œåœ¨é—®é¢˜
          const issues = [];
          if (styles.display === 'none') issues.push('display: none');
          if (styles.visibility === 'hidden') issues.push('visibility: hidden');
          if (parseFloat(styles.opacity) < 0.1) issues.push('opacity è¿‡ä½');
          if (styles.color === styles.backgroundColor) issues.push('æ–‡æœ¬é¢œè‰²ä¸èƒŒæ™¯ç›¸åŒ');
          if (styles.fontSize === '0px') issues.push('å­—ä½“å¤§å°ä¸º 0');
          if (styles.width === '0px' || styles.height === '0px') issues.push('å…ƒç´ å°ºå¯¸ä¸º 0');

          if (issues.length > 0) {
            appendResult(`<p class="status-error">âš ï¸ å‘ç°é—®é¢˜: ${issues.join(', ')}</p>`);
          } else {
            appendResult(`<p class="status-good">âœ… æ ·å¼æ­£å¸¸</p>`);
          }
        } else {
          appendResult(`<p class="status-warning">âš ï¸ æœªæ‰¾åˆ° ${selector}</p>`);
        }
      }

      appendResult('</div>');
    }

    async function checkElementVisibility() {
      appendResult('<div class="diagnostic-panel section"><h3>ğŸ‘ï¸ æ£€æŸ¥å…ƒç´ å¯è§æ€§</h3>');

      const messageItems = document.querySelectorAll('[data-message-id]');

      for (let i = 0; i < Math.min(3, messageItems.length); i++) {
        const item = messageItems[i];
        const rect = item.getBoundingClientRect();
        const messageId = item.getAttribute('data-message-id');

        appendResult(`<div class="code-block">
<strong>æ¶ˆæ¯ ${messageId} è¾¹ç•Œæ¡†:</strong>
â€¢ top: ${rect.top}px
â€¢ left: ${rect.left}px  
â€¢ width: ${rect.width}px
â€¢ height: ${rect.height}px
â€¢ bottom: ${rect.bottom}px
â€¢ right: ${rect.right}px
â€¢ åœ¨è§†å£å†…: ${rect.top >= 0 && rect.left >= 0 && rect.bottom <= window.innerHeight && rect.right <= window.innerWidth}
â€¢ å¯è§†åŒºåŸŸ: ${rect.width > 0 && rect.height > 0}
                </div>`);

        // æ£€æŸ¥æ–‡æœ¬å…ƒç´ 
        const textElement = item.querySelector('.message-text');
        if (textElement) {
          const textRect = textElement.getBoundingClientRect();
          appendResult(`<div class="code-block">
<strong>æ–‡æœ¬å…ƒç´ è¾¹ç•Œæ¡†:</strong>
â€¢ width: ${textRect.width}px
â€¢ height: ${textRect.height}px
â€¢ å¯è§: ${textRect.width > 0 && textRect.height > 0}
                    </div>`);
        }
      }

      // æ£€æŸ¥è§†å£å’Œæ»šåŠ¨ä½ç½®
      const scrollContainer = document.querySelector('.simple-message-list');
      if (scrollContainer) {
        appendResult(`<div class="code-block">
<strong>æ»šåŠ¨å®¹å™¨çŠ¶æ€:</strong>
â€¢ scrollTop: ${scrollContainer.scrollTop}px
â€¢ scrollHeight: ${scrollContainer.scrollHeight}px
â€¢ clientHeight: ${scrollContainer.clientHeight}px
â€¢ æ»šåŠ¨åˆ°åº•éƒ¨: ${Math.abs(scrollContainer.scrollTop + scrollContainer.clientHeight - scrollContainer.scrollHeight) < 5}
                </div>`);
      }

      appendResult('</div>');
    }

    async function analyzeContainerStructure() {
      appendResult('<div class="diagnostic-panel section"><h3>ğŸ“ åˆ†æå®¹å™¨ç»“æ„</h3>');

      // åˆ†æDOMå±‚æ¬¡ç»“æ„
      const mainContainer = document.querySelector('.simple-message-list');
      if (mainContainer) {
        appendResult('<p class="status-good">âœ… æ‰¾åˆ°ä¸»å®¹å™¨ .simple-message-list</p>');

        const messagesWrapper = mainContainer.querySelector('.messages-wrapper');
        if (messagesWrapper) {
          appendResult('<p class="status-good">âœ… æ‰¾åˆ°æ¶ˆæ¯åŒ…è£…å™¨ .messages-wrapper</p>');

          const messageWrappers = messagesWrapper.querySelectorAll('.message-wrapper');
          appendResult(`<p>æ¶ˆæ¯åŒ…è£…å™¨æ•°é‡: ${messageWrappers.length}</p>`);

          if (messageWrappers.length > 0) {
            const firstWrapper = messageWrappers[0];
            const wrapperRect = firstWrapper.getBoundingClientRect();

            appendResult(`<div class="code-block">
<strong>ç¬¬ä¸€ä¸ªæ¶ˆæ¯åŒ…è£…å™¨:</strong>
â€¢ ä½ç½®: (${wrapperRect.left}, ${wrapperRect.top})
â€¢ å°ºå¯¸: ${wrapperRect.width} x ${wrapperRect.height}
â€¢ å­å…ƒç´ æ•°é‡: ${firstWrapper.children.length}
                        </div>`);
          }
        } else {
          appendResult('<p class="status-error">âŒ æœªæ‰¾åˆ° .messages-wrapper</p>');
        }
      } else {
        appendResult('<p class="status-error">âŒ æœªæ‰¾åˆ°ä¸»å®¹å™¨ .simple-message-list</p>');
      }

      // æ£€æŸ¥CSSç½‘æ ¼/Flexboxå¸ƒå±€
      const wrappers = document.querySelectorAll('.messages-wrapper, .message-wrapper');
      wrappers.forEach((wrapper, index) => {
        const styles = getComputedStyle(wrapper);
        if (styles.display.includes('flex') || styles.display.includes('grid')) {
          appendResult(`<p>å®¹å™¨ ${index}: ä½¿ç”¨ ${styles.display} å¸ƒå±€</p>`);
        }
      });

      appendResult('</div>');
    }

    async function generateFixSuggestions() {
      appendResult('<div class="diagnostic-panel section"><h3>ğŸ”§ ä¿®å¤å»ºè®®</h3>');

      const suggestions = [];
      const messageElements = document.querySelectorAll('[data-message-id]');

      if (messageElements.length === 0) {
        suggestions.push({
          priority: 'HIGH',
          issue: 'æœªæ‰¾åˆ°ä»»ä½•æ¶ˆæ¯å…ƒç´ ',
          fix: 'æ£€æŸ¥Vueç»„ä»¶æ˜¯å¦æ­£ç¡®æ¸²æŸ“ï¼Œç¡®è®¤data-message-idå±æ€§æ˜¯å¦æ­£ç¡®æ·»åŠ '
        });
      }

      // æ£€æŸ¥æ–‡æœ¬å…ƒç´ 
      let hasTextIssues = false;
      messageElements.forEach(item => {
        const textElement = item.querySelector('.message-text');
        if (!textElement) {
          hasTextIssues = true;
        }
      });

      if (hasTextIssues) {
        suggestions.push({
          priority: 'HIGH',
          issue: 'æ¶ˆæ¯æ–‡æœ¬å…ƒç´ ç¼ºå¤±',
          fix: 'æ£€æŸ¥MessageItem.vueä¸­v-if="message.content"æ¡ä»¶ï¼Œç¡®è®¤æ¶ˆæ¯å¯¹è±¡ç»“æ„'
        });
      }

      // æ£€æŸ¥CSSé—®é¢˜
      const messagesWrapper = document.querySelector('.messages-wrapper');
      if (messagesWrapper) {
        const styles = getComputedStyle(messagesWrapper);
        if (styles.minHeight === '100vh') {
          suggestions.push({
            priority: 'MEDIUM',
            issue: '.messages-wrapperä½¿ç”¨min-height: 100vh',
            fix: 'æ”¹ä¸ºmin-height: 100%ä»¥é€‚é…çˆ¶å®¹å™¨'
          });
        }
      }

      // è¾“å‡ºå»ºè®®
      suggestions.forEach(suggestion => {
        const priorityClass = suggestion.priority === 'HIGH' ? 'status-error' :
          suggestion.priority === 'MEDIUM' ? 'status-warning' : 'status-good';

        appendResult(`<div class="code-block">
<span class="${priorityClass}">[${suggestion.priority}]</span> <strong>${suggestion.issue}</strong>
ä¿®å¤æ–¹æ¡ˆ: ${suggestion.fix}
                </div>`);
      });

      if (suggestions.length === 0) {
        appendResult('<p class="status-good">âœ… æœªå‘ç°æ˜æ˜¾é—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥è°ƒè¯•</p>');
      }

      // æä¾›å¿«é€Ÿä¿®å¤ä»£ç 
      appendResult(`<div class="code-block">
<strong>å¿«é€ŸCSSä¿®å¤ï¼ˆåœ¨å¼€å‘è€…å·¥å…·ä¸­æµ‹è¯•ï¼‰:</strong>
.messages-wrapper { min-height: 100% !important; }
.message-text { 
    color: #374151 !important; 
    display: block !important; 
    opacity: 1 !important; 
}
.message-item { 
    background: #ffffff !important; 
    border: 1px solid #e5e7eb !important; 
}
            </div>`);

      appendResult('</div>');
    }

    function appendResult(html) {
      const results = document.getElementById('results');
      results.innerHTML += html;
    }

    // è‡ªåŠ¨è¿è¡Œåˆå§‹æ£€æŸ¥
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        appendResult('<div class="diagnostic-panel"><h3>ğŸ¯ å¿«é€ŸçŠ¶æ€æ£€æŸ¥</h3>');

        const messageCount = document.querySelectorAll('[data-message-id]').length;
        const textCount = document.querySelectorAll('.message-text').length;

        appendResult(`<p>æ¶ˆæ¯å…ƒç´ : ${messageCount} ä¸ª</p>`);
        appendResult(`<p>æ–‡æœ¬å…ƒç´ : ${textCount} ä¸ª</p>`);

        if (messageCount === 0) {
          appendResult('<p class="status-error">âŒ å…³é”®é—®é¢˜ï¼šæœªæ‰¾åˆ°ä»»ä½•æ¶ˆæ¯å…ƒç´ </p>');
        } else if (textCount === 0) {
          appendResult('<p class="status-error">âŒ å…³é”®é—®é¢˜ï¼šæœªæ‰¾åˆ°ä»»ä½•æ–‡æœ¬å†…å®¹</p>');
        } else {
          appendResult('<p class="status-good">âœ… åŸºç¡€å…ƒç´ æ£€æŸ¥é€šè¿‡</p>');
        }

        appendResult('</div>');
      }, 1000);
    });
  </script>
</body>

</html>