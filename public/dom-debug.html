<!DOCTYPE html>
<html>

<head>
  <title>æ¶ˆæ¯DOMè°ƒè¯•</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
    }

    .debug {
      background: #f5f5f5;
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
    }

    .error {
      background: #ffebee;
      color: #c62828;
    }

    .success {
      background: #e8f5e8;
      color: #2e7d32;
    }

    .warning {
      background: #fff3e0;
      color: #ef6c00;
    }

    button {
      background: #7c3aed;
      color: white;
      border: none;
      padding: 8px 16px;
      margin: 5px;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <h2>ğŸ” æ¶ˆæ¯DOMè°ƒè¯•å·¥å…·</h2>
  <button onclick="checkDOM()">æ£€æŸ¥DOMç»“æ„</button>
  <button onclick="checkStyles()">æ£€æŸ¥CSSæ ·å¼</button>
  <button onclick="checkVue()">æ£€æŸ¥VueçŠ¶æ€</button>

  <div id="results"></div>

  <script>
    function log(msg, type = 'debug') {
      const div = document.createElement('div');
      div.className = `debug ${type}`;
      div.innerHTML = msg;
      document.getElementById('results').appendChild(div);
    }

    function clear() {
      document.getElementById('results').innerHTML = '';
    }

    function checkDOM() {
      clear();
      log('å¼€å§‹DOMæ£€æŸ¥...', 'debug');

      const messageList = document.querySelector('.simple-message-list');
      const messagesWrapper = document.querySelector('.messages-wrapper');
      const messageWrappers = document.querySelectorAll('.message-wrapper');
      const dividers = document.querySelectorAll('[data-v-]');

      log(`æ¶ˆæ¯åˆ—è¡¨å®¹å™¨: ${messageList ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°'}`, messageList ? 'success' : 'error');
      log(`æ¶ˆæ¯åŒ…è£…å™¨: ${messagesWrapper ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°'}`, messagesWrapper ? 'success' : 'error');
      log(`æ¶ˆæ¯å®¹å™¨æ•°é‡: ${messageWrappers.length}`, messageWrappers.length > 0 ? 'success' : 'warning');

      if (messagesWrapper) {
        log(`åŒ…è£…å™¨å­å…ƒç´ : ${messagesWrapper.children.length}`, 'debug');
        Array.from(messagesWrapper.children).slice(0, 5).forEach((child, i) => {
          log(`  å­å…ƒç´ ${i + 1}: ${child.tagName} ${child.className}`, 'debug');
        });
      }

      messageWrappers.forEach((wrapper, i) => {
        if (i < 3) {
          const rect = wrapper.getBoundingClientRect();
          log(`æ¶ˆæ¯${i + 1}: ${rect.width}Ã—${rect.height}, å¯è§=${rect.height > 0}`, rect.height > 0 ? 'success' : 'error');
        }
      });
    }

    function checkStyles() {
      clear();
      log('å¼€å§‹æ ·å¼æ£€æŸ¥...', 'debug');

      const messagesWrapper = document.querySelector('.messages-wrapper');
      if (messagesWrapper) {
        const styles = getComputedStyle(messagesWrapper);
        log(`åŒ…è£…å™¨æ ·å¼:`, 'debug');
        log(`  display: ${styles.display}`, 'debug');
        log(`  height: ${styles.height}`, 'debug');
        log(`  min-height: ${styles.minHeight}`, styles.minHeight.includes('vh') ? 'error' : 'success');
        log(`  overflow: ${styles.overflow}`, 'debug');
      }

      const firstMessage = document.querySelector('.message-wrapper');
      if (firstMessage) {
        const styles = getComputedStyle(firstMessage);
        log(`æ¶ˆæ¯æ ·å¼:`, 'debug');
        log(`  display: ${styles.display}`, 'debug');
        log(`  height: ${styles.height}`, 'debug');
        log(`  visibility: ${styles.visibility}`, 'debug');
      }
    }

    function checkVue() {
      clear();
      log('å¼€å§‹Vueæ£€æŸ¥...', 'debug');

      const messageList = document.querySelector('.simple-message-list');
      if (messageList && messageList.__vueParentComponent) {
        const state = messageList.__vueParentComponent.setupState;
        if (state.enhancedMessages) {
          log(`enhancedMessages: ${state.enhancedMessages.length}é¡¹`, 'success');

          const messages = state.enhancedMessages.filter(item => !item.type || (item.type !== 'date-divider' && item.type !== 'session-divider'));
          const dividers = state.enhancedMessages.filter(item => item.type === 'date-divider' || item.type === 'session-divider');

          log(`  æ¶ˆæ¯: ${messages.length}, åˆ†å‰²çº¿: ${dividers.length}`, 'debug');

          if (state.enhancedMessages.length > 0) {
            state.enhancedMessages.slice(0, 3).forEach((item, i) => {
              log(`  é¡¹ç›®${i + 1}: type=${item.type || 'æ— '}, id=${item.id}`, 'debug');
            });
          }
        }
      } else {
        log('æ— æ³•è®¿é—®Vueç»„ä»¶', 'error');
      }
    }

    // é¡µé¢åŠ è½½åè‡ªåŠ¨æ£€æŸ¥
    setTimeout(() => {
      checkDOM();
      setTimeout(checkStyles, 500);
      setTimeout(checkVue, 1000);
    }, 2000);
  </script>
</body>

</html>