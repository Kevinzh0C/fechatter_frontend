<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jump Detective - è·³è½¬ç›‘æ§å·¥å…·</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #fff; }
        .control { margin: 10px 0; padding: 10px; background: #333; border-radius: 5px; }
        button { padding: 8px 16px; margin: 5px; background: #5865f2; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #4752c4; }
        .log { background: #000; padding: 10px; border-radius: 5px; height: 300px; overflow-y: auto; font-size: 12px; }
        .error { color: #ff6b6b; }
        .warning { color: #ffd93d; }
        .info { color: #6bcf7f; }
    </style>
</head>
<body>
    <h1>ğŸš¨ Jump Detective - è·³è½¬ç›‘æ§å·¥å…·</h1>
    <p>è¿™ä¸ªå·¥å…·å¯ä»¥ç›‘æ§å’Œé˜»æ­¢å†å²æ¶ˆæ¯åŠ è½½æ—¶çš„è·³è½¬è¡Œä¸º</p>
    
    <div class="control">
        <h3>ğŸ”§ è·³è½¬æ§åˆ¶</h3>
        <button onclick="enableAllBlocking()">ğŸ”´ é˜»æ­¢æ‰€æœ‰è·³è½¬</button>
        <button onclick="disableAllBlocking()">ğŸŸ¢ å…è®¸æ‰€æœ‰è·³è½¬</button>
        <button onclick="blockScrollTopOnly()">ğŸ”´ ä»…é˜»æ­¢scrollTop</button>
        <button onclick="blockScrollToOnly()">ğŸ”´ ä»…é˜»æ­¢scrollTo</button>
        <button onclick="blockScrollIntoViewOnly()">ğŸ”´ ä»…é˜»æ­¢scrollIntoView</button>
    </div>
    
    <div class="control">
        <h3>ğŸ“Š ç›‘æ§æ—¥å¿—</h3>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="log" class="log"></div>
    </div>
    
    <script>
        // å…¨å±€è·³è½¬ç›‘æ§é…ç½®
        window.jumpDetectiveConfig = {
            blockScrollTop: false,
            blockScrollTo: false,
            blockScrollIntoView: false,
            logEnabled: true
        };
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function enableAllBlocking() {
            window.jumpDetectiveConfig.blockScrollTop = true;
            window.jumpDetectiveConfig.blockScrollTo = true;
            window.jumpDetectiveConfig.blockScrollIntoView = true;
            log('ğŸ”´ æ‰€æœ‰è·³è½¬é˜»æ­¢å·²å¯ç”¨', 'error');
        }
        
        function disableAllBlocking() {
            window.jumpDetectiveConfig.blockScrollTop = false;
            window.jumpDetectiveConfig.blockScrollTo = false;
            window.jumpDetectiveConfig.blockScrollIntoView = false;
            log('ğŸŸ¢ æ‰€æœ‰è·³è½¬é˜»æ­¢å·²ç¦ç”¨', 'info');
        }
        
        function blockScrollTopOnly() {
            window.jumpDetectiveConfig.blockScrollTop = true;
            log('ğŸ”´ scrollTop é˜»æ­¢å·²å¯ç”¨', 'warning');
        }
        
        function blockScrollToOnly() {
            window.jumpDetectiveConfig.blockScrollTo = true;
            log('ğŸ”´ scrollTo é˜»æ­¢å·²å¯ç”¨', 'warning');
        }
        
        function blockScrollIntoViewOnly() {
            window.jumpDetectiveConfig.blockScrollIntoView = true;
            log('ğŸ”´ scrollIntoView é˜»æ­¢å·²å¯ç”¨', 'warning');
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // æ³¨å…¥ç›‘æ§ä»£ç åˆ°ä¸»çª—å£
        function injectJumpDetection() {
            if (window.parent && window.parent !== window) {
                const parentWindow = window.parent;
                
                // ç›‘æ§ scrollTop è®¾ç½®
                const originalScrollTopDescriptor = Object.getOwnPropertyDescriptor(Element.prototype, 'scrollTop');
                
                // é‡å†™æ‰€æœ‰å¯èƒ½çš„æ»šåŠ¨å®¹å™¨çš„scrollTop
                const containers = parentWindow.document.querySelectorAll('.discord-message-list, [data-chat-id]');
                containers.forEach(container => {
                    if (container.scrollTop !== undefined) {
                        Object.defineProperty(container, 'scrollTop', {
                            get: originalScrollTopDescriptor.get,
                            set: function(value) {
                                if (window.jumpDetectiveConfig?.blockScrollTop && 
                                    (value === 0 || (this.scrollTop > 200 && value < 100))) {
                                    log(`ğŸ”´ é˜»æ­¢äº†å¯ç–‘çš„scrollTopè·³è½¬: ${this.scrollTop} -> ${value}`, 'error');
                                    return;
                                }
                                log(`ğŸ“ scrollTopå˜åŒ–: ${this.scrollTop} -> ${value}`, 'info');
                                return originalScrollTopDescriptor.set.call(this, value);
                            },
                            configurable: true
                        });
                    }
                });
                
                log('ğŸš¨ è·³è½¬ç›‘æ§å·²æ³¨å…¥åˆ°ä¸»çª—å£', 'info');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ³¨å…¥ç›‘æ§
        window.addEventListener('load', injectJumpDetection);
        
        log('ğŸš¨ Jump Detective å·¥å…·å·²å¯åŠ¨', 'info');
        log('ğŸ’¡ è¯·åœ¨ä¸»åº”ç”¨ä¸­é‡ç°è·³è½¬é—®é¢˜ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºç›‘æ§æ—¥å¿—', 'info');
    </script>
</body>
</html> 