<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” MessageInput å‘é€æœºåˆ¶è¯Šæ–­å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .debug-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .debug-result {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #e53e3e;
        }

        .debug-result.success {
            border-left-color: #38a169;
            background: #f0fff4;
        }

        .debug-result.warning {
            border-left-color: #d69e2e;
            background: #fffbf0;
        }

        .debug-result.error {
            border-left-color: #e53e3e;
            background: #fef5f5;
        }

        .debug-button {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 10px 10px 0;
        }

        .debug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(229, 62, 62, 0.3);
        }

        .code-output {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            overflow-x: auto;
            margin-top: 10px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.success {
            background: #38a169;
        }

        .status-indicator.error {
            background: #e53e3e;
        }

        .status-indicator.warning {
            background: #d69e2e;
        }

        .test-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .test-input:focus {
            outline: none;
            border-color: #e53e3e;
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.1);
        }

        .test-results {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .result-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .real-time-monitor {
            position: sticky;
            top: 20px;
            background: #1a202c;
            color: #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .monitor-title {
            color: #63b3ed;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .monitor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #2d3748;
        }

        .monitor-item:last-child {
            border-bottom: none;
        }

        .monitor-value {
            font-family: 'JetBrains Mono', monospace;
            color: #68d391;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <div class="header">
            <h1>ğŸ” MessageInput å‘é€æœºåˆ¶è¯Šæ–­å·¥å…·</h1>
            <p>æ£€æµ‹Fechatterå‰ç«¯å‘é€æ¶ˆæ¯åŠŸèƒ½çš„å„ä¸ªç¯èŠ‚</p>
        </div>

        <div class="content">
            <!-- å®æ—¶ç›‘æ§ -->
            <div class="real-time-monitor">
                <div class="monitor-title">ğŸ“Š å®æ—¶çŠ¶æ€ç›‘æ§</div>
                <div class="monitor-item">
                    <span>é¡µé¢URL:</span>
                    <span class="monitor-value" id="pageUrl">-</span>
                </div>
                <div class="monitor-item">
                    <span>ChatIdå­˜åœ¨:</span>
                    <span class="monitor-value" id="chatIdStatus">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="monitor-item">
                    <span>MessageInputç»„ä»¶:</span>
                    <span class="monitor-value" id="componentStatus">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="monitor-item">
                    <span>å‘é€æŒ‰é’®çŠ¶æ€:</span>
                    <span class="monitor-value" id="sendButtonStatus">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="monitor-item">
                    <span>ChatServiceå¯ç”¨:</span>
                    <span class="monitor-value" id="chatServiceStatus">æ£€æŸ¥ä¸­...</span>
                </div>
            </div>

            <!-- åŸºç¡€ç¯å¢ƒæ£€æŸ¥ -->
            <div class="section">
                <h2>ğŸ”§ åŸºç¡€ç¯å¢ƒæ£€æŸ¥</h2>
                
                <button class="debug-button" onclick="checkEnvironment()">æ£€æŸ¥ç¯å¢ƒ</button>
                <button class="debug-button" onclick="checkVueComponents()">æ£€æŸ¥Vueç»„ä»¶</button>
                <button class="debug-button" onclick="checkChatContext()">æ£€æŸ¥èŠå¤©ä¸Šä¸‹æ–‡</button>
                
                <div id="environmentResults"></div>
            </div>

            <!-- MessageInputæ£€æŸ¥ -->
            <div class="section">
                <h2>ğŸ“ MessageInputç»„ä»¶æ£€æŸ¥</h2>
                
                <button class="debug-button" onclick="findMessageInputs()">æŸ¥æ‰¾MessageInputç»„ä»¶</button>
                <button class="debug-button" onclick="checkCanSend()">æ£€æŸ¥canSendé€»è¾‘</button>
                <button class="debug-button" onclick="testSendButton()">æµ‹è¯•å‘é€æŒ‰é’®</button>
                
                <div class="test-input-container">
                    <input type="text" class="test-input" id="testMessage" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯..." 
                           oninput="simulateTyping(this.value)">
                </div>
                
                <div id="messageInputResults"></div>
            </div>

            <!-- å‘é€æµç¨‹æµ‹è¯• -->
            <div class="section">
                <h2>ğŸš€ å‘é€æµç¨‹æµ‹è¯•</h2>
                
                <button class="debug-button" onclick="testSendFlow()">æµ‹è¯•å‘é€æµç¨‹</button>
                <button class="debug-button" onclick="simulateUserInput()">æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥</button>
                <button class="debug-button" onclick="checkEventHandlers()">æ£€æŸ¥äº‹ä»¶å¤„ç†</button>
                
                <div id="sendFlowResults"></div>
            </div>

            <!-- é”™è¯¯è¯Šæ–­ -->
            <div class="section">
                <h2>âš ï¸ é”™è¯¯è¯Šæ–­ä¸ä¿®å¤å»ºè®®</h2>
                
                <button class="debug-button" onclick="runDiagnostics()">è¿è¡Œå®Œæ•´è¯Šæ–­</button>
                <button class="debug-button" onclick="generateFix()">ç”Ÿæˆä¿®å¤å»ºè®®</button>
                
                <div id="diagnosticsResults"></div>
            </div>
        </div>
    </div>

    <script>
        // å®æ—¶ç›‘æ§
        function updateMonitoring() {
            document.getElementById('pageUrl').textContent = window.location.href;
            
            // æ£€æŸ¥ChatId
            const chatId = getChatId();
            document.getElementById('chatIdStatus').textContent = chatId ? `å­˜åœ¨: ${chatId}` : 'âŒ æœªæ‰¾åˆ°';
            
            // æ£€æŸ¥ç»„ä»¶
            const component = findMessageInput();
            document.getElementById('componentStatus').textContent = component ? 'âœ… å·²æ‰¾åˆ°' : 'âŒ æœªæ‰¾åˆ°';
            
            // æ£€æŸ¥å‘é€æŒ‰é’®
            const sendBtn = findSendButton();
            document.getElementById('sendButtonStatus').textContent = sendBtn ? 
                (sendBtn.disabled ? 'ğŸ”’ å·²ç¦ç”¨' : 'âœ… å¯ç”¨') : 'âŒ æœªæ‰¾åˆ°';
                
            // æ£€æŸ¥ChatService
            checkChatServiceAvailable().then(available => {
                document.getElementById('chatServiceStatus').textContent = available ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨';
            });
        }

        // è·å–ChatId
        function getChatId() {
            // å¤šç§æ–¹å¼è·å–ChatId
            const urlMatch = window.location.pathname.match(/\/chat\/(\d+)/);
            if (urlMatch) return urlMatch[1];
            
            // ä»Vueå®ä¾‹è·å–
            if (window.__VUE_DEVTOOLS_GLOBAL_HOOK__) {
                // å°è¯•ä»Vueå®ä¾‹è·å–
                try {
                    const app = document.querySelector('#app')?.__vue_app__;
                    if (app) {
                        const chatStore = app.config.globalProperties.$chatStore || 
                                        app.config.globalProperties.$stores?.chat;
                        if (chatStore?.currentChatId) {
                            return chatStore.currentChatId;
                        }
                    }
                } catch (e) {
                    console.log('è·å–Vueå®ä¾‹ChatIdå¤±è´¥:', e);
                }
            }
            
            return null;
        }

        // æŸ¥æ‰¾MessageInputç»„ä»¶
        function findMessageInput() {
            // æŸ¥æ‰¾åŒ…å«MessageInputçš„å…ƒç´ 
            const selectors = [
                '.message-input',
                '[data-component="MessageInput"]',
                'textarea[placeholder*="message"]',
                'input[placeholder*="message"]'
            ];
            
            for (const selector of selectors) {
                const element = document.querySelector(selector);
                if (element) return element;
            }
            
            return null;
        }

        // æŸ¥æ‰¾å‘é€æŒ‰é’®
        function findSendButton() {
            const selectors = [
                '.send-btn',
                'button[title*="send"]',
                'button[aria-label*="send"]',
                'button:has(svg[stroke="currentColor"])',
                '.input-btn.send-btn'
            ];
            
            for (const selector of selectors) {
                try {
                    const element = document.querySelector(selector);
                    if (element) return element;
                } catch (e) {
                    // æŸäº›é€‰æ‹©å™¨å¯èƒ½ä¸è¢«æ”¯æŒ
                    console.log('é€‰æ‹©å™¨ä¸æ”¯æŒ:', selector);
                }
            }
            
            return null;
        }

        // æ£€æŸ¥ChatServiceæ˜¯å¦å¯ç”¨
        async function checkChatServiceAvailable() {
            try {
                const ChatService = await import('/src/services/ChatService.ts');
                return !!ChatService.default;
            } catch (error) {
                console.log('ChatServiceå¯¼å…¥å¤±è´¥:', error);
                return false;
            }
        }

        // åŸºç¡€ç¯å¢ƒæ£€æŸ¥
        function checkEnvironment() {
            const results = [];
            
            // æ£€æŸ¥Vue
            const hasVue = !!window.Vue || !!document.querySelector('[data-v-]');
            results.push({
                name: 'Vue.js',
                status: hasVue ? 'success' : 'error',
                message: hasVue ? 'Vue.js å·²åŠ è½½' : 'Vue.js æœªæ£€æµ‹åˆ°'
            });
            
            // æ£€æŸ¥å¼€å‘æœåŠ¡å™¨
            const isDev = window.location.hostname === 'localhost';
            results.push({
                name: 'å¼€å‘ç¯å¢ƒ',
                status: isDev ? 'success' : 'warning',
                message: isDev ? 'å¼€å‘æœåŠ¡å™¨è¿è¡Œä¸­' : 'éå¼€å‘ç¯å¢ƒ'
            });
            
            // æ£€æŸ¥æ§åˆ¶å°é”™è¯¯
            const errors = [];
            const originalError = console.error;
            console.error = function(...args) {
                errors.push(args.join(' '));
                originalError.apply(console, args);
            };
            
            setTimeout(() => {
                results.push({
                    name: 'æ§åˆ¶å°é”™è¯¯',
                    status: errors.length === 0 ? 'success' : 'warning',
                    message: errors.length === 0 ? 'æ— é”™è¯¯' : `å‘ç° ${errors.length} ä¸ªé”™è¯¯`
                });
                
                displayResults('environmentResults', results);
            }, 1000);
        }

        // æ£€æŸ¥Vueç»„ä»¶
        function checkVueComponents() {
            const results = [];
            
            // æ£€æŸ¥MessageInputç»„ä»¶
            const messageInput = findMessageInput();
            results.push({
                name: 'MessageInputç»„ä»¶',
                status: messageInput ? 'success' : 'error',
                message: messageInput ? 'ç»„ä»¶å·²æ‰¾åˆ°' : 'ç»„ä»¶æœªæ‰¾åˆ°'
            });
            
            // æ£€æŸ¥å‘é€æŒ‰é’®
            const sendBtn = findSendButton();
            results.push({
                name: 'å‘é€æŒ‰é’®',
                status: sendBtn ? 'success' : 'error',
                message: sendBtn ? 'æŒ‰é’®å·²æ‰¾åˆ°' : 'æŒ‰é’®æœªæ‰¾åˆ°'
            });
            
            if (sendBtn) {
                results.push({
                    name: 'æŒ‰é’®çŠ¶æ€',
                    status: sendBtn.disabled ? 'warning' : 'success',
                    message: sendBtn.disabled ? 'æŒ‰é’®å·²ç¦ç”¨' : 'æŒ‰é’®å¯ç”¨'
                });
            }
            
            displayResults('environmentResults', results);
        }

        // æ£€æŸ¥èŠå¤©ä¸Šä¸‹æ–‡
        function checkChatContext() {
            const results = [];
            
            const chatId = getChatId();
            results.push({
                name: 'Chat ID',
                status: chatId ? 'success' : 'error',
                message: chatId ? `å½“å‰èŠå¤©: ${chatId}` : 'æœªæ‰¾åˆ°å½“å‰èŠå¤©ID'
            });
            
            // æ£€æŸ¥è·¯ç”±
            const isInChat = window.location.pathname.includes('/chat');
            results.push({
                name: 'èŠå¤©é¡µé¢',
                status: isInChat ? 'success' : 'warning',
                message: isInChat ? 'å½“å‰åœ¨èŠå¤©é¡µé¢' : 'ä¸åœ¨èŠå¤©é¡µé¢'
            });
            
            displayResults('environmentResults', results);
        }

        // æŸ¥æ‰¾MessageInputç»„ä»¶
        function findMessageInputs() {
            const results = [];
            const messageInput = findMessageInput();
            
            if (messageInput) {
                results.push({
                    name: 'ç»„ä»¶å®šä½',
                    status: 'success',
                    message: `æ‰¾åˆ°ç»„ä»¶: ${messageInput.tagName.toLowerCase()}`
                });
                
                // æ£€æŸ¥Vueå®ä¾‹
                if (messageInput.__vue__ || messageInput._vnode) {
                    results.push({
                        name: 'Vueå®ä¾‹',
                        status: 'success',
                        message: 'ç»„ä»¶å·²æŒ‚è½½Vueå®ä¾‹'
                    });
                } else {
                    results.push({
                        name: 'Vueå®ä¾‹',
                        status: 'warning',
                        message: 'æœªæ£€æµ‹åˆ°Vueå®ä¾‹'
                    });
                }
                
                // æ£€æŸ¥ç›¸å…³å±æ€§
                const hasPlaceholder = messageInput.placeholder;
                results.push({
                    name: 'å ä½ç¬¦',
                    status: hasPlaceholder ? 'success' : 'warning',
                    message: hasPlaceholder ? `å ä½ç¬¦: ${hasPlaceholder}` : 'æ— å ä½ç¬¦'
                });
            } else {
                results.push({
                    name: 'ç»„ä»¶å®šä½',
                    status: 'error',
                    message: 'æœªæ‰¾åˆ°MessageInputç»„ä»¶'
                });
            }
            
            displayResults('messageInputResults', results);
        }

        // æ£€æŸ¥canSendé€»è¾‘
        function checkCanSend() {
            const results = [];
            const messageInput = findMessageInput();
            const sendBtn = findSendButton();
            
            if (messageInput && sendBtn) {
                // æ¨¡æ‹Ÿè¾“å…¥æ–‡æœ¬
                messageInput.value = 'æµ‹è¯•æ¶ˆæ¯';
                messageInput.dispatchEvent(new Event('input', { bubbles: true }));
                
                setTimeout(() => {
                    const isDisabled = sendBtn.disabled;
                    results.push({
                        name: 'canSendæµ‹è¯•',
                        status: !isDisabled ? 'success' : 'error',
                        message: !isDisabled ? 'è¾“å…¥æ–‡æœ¬åæŒ‰é’®å¯ç”¨' : 'è¾“å…¥æ–‡æœ¬åæŒ‰é’®ä»ç¦ç”¨'
                    });
                    
                    // æ¸…ç©ºè¾“å…¥
                    messageInput.value = '';
                    messageInput.dispatchEvent(new Event('input', { bubbles: true }));
                    
                    setTimeout(() => {
                        const isDisabledEmpty = sendBtn.disabled;
                        results.push({
                            name: 'ç©ºè¾“å…¥æµ‹è¯•',
                            status: isDisabledEmpty ? 'success' : 'warning',
                            message: isDisabledEmpty ? 'ç©ºè¾“å…¥æ—¶æŒ‰é’®æ­£ç¡®ç¦ç”¨' : 'ç©ºè¾“å…¥æ—¶æŒ‰é’®æœªç¦ç”¨'
                        });
                        
                        displayResults('messageInputResults', results);
                    }, 100);
                }, 100);
            } else {
                results.push({
                    name: 'canSendæµ‹è¯•',
                    status: 'error',
                    message: 'æ— æ³•æ‰¾åˆ°è¾“å…¥æ¡†æˆ–å‘é€æŒ‰é’®'
                });
                displayResults('messageInputResults', results);
            }
        }

        // æµ‹è¯•å‘é€æŒ‰é’®
        function testSendButton() {
            const results = [];
            const sendBtn = findSendButton();
            
            if (sendBtn) {
                // æ·»åŠ ç‚¹å‡»ç›‘å¬å™¨
                let clicked = false;
                const testHandler = () => { clicked = true; };
                sendBtn.addEventListener('click', testHandler, { once: true });
                
                // æ¨¡æ‹Ÿç‚¹å‡»
                sendBtn.click();
                
                setTimeout(() => {
                    results.push({
                        name: 'ç‚¹å‡»æµ‹è¯•',
                        status: clicked ? 'success' : 'error',
                        message: clicked ? 'æŒ‰é’®ç‚¹å‡»äº‹ä»¶æ­£å¸¸' : 'æŒ‰é’®ç‚¹å‡»äº‹ä»¶æœªè§¦å‘'
                    });
                    
                    sendBtn.removeEventListener('click', testHandler);
                    displayResults('messageInputResults', results);
                }, 100);
            } else {
                results.push({
                    name: 'ç‚¹å‡»æµ‹è¯•',
                    status: 'error',
                    message: 'æœªæ‰¾åˆ°å‘é€æŒ‰é’®'
                });
                displayResults('messageInputResults', results);
            }
        }

        // æ¨¡æ‹Ÿè¾“å…¥
        function simulateTyping(value) {
            const messageInput = findMessageInput();
            const sendBtn = findSendButton();
            
            if (messageInput && sendBtn) {
                messageInput.value = value;
                messageInput.dispatchEvent(new Event('input', { bubbles: true }));
                
                const status = sendBtn.disabled ? 'ğŸ”’ ç¦ç”¨' : 'âœ… å¯ç”¨';
                document.getElementById('sendButtonStatus').textContent = status;
            }
        }

        // æµ‹è¯•å‘é€æµç¨‹
        async function testSendFlow() {
            const results = [];
            
            try {
                // æ£€æŸ¥ChatService
                const ChatService = await import('/src/services/ChatService.ts');
                results.push({
                    name: 'ChatServiceå¯¼å…¥',
                    status: 'success',
                    message: 'ChatServiceæˆåŠŸå¯¼å…¥'
                });
                
                // æ£€æŸ¥sendMessageæ–¹æ³•
                if (typeof ChatService.default.sendMessage === 'function') {
                    results.push({
                        name: 'sendMessageæ–¹æ³•',
                        status: 'success',
                        message: 'sendMessageæ–¹æ³•å­˜åœ¨'
                    });
                } else {
                    results.push({
                        name: 'sendMessageæ–¹æ³•',
                        status: 'error',
                        message: 'sendMessageæ–¹æ³•ä¸å­˜åœ¨'
                    });
                }
                
            } catch (error) {
                results.push({
                    name: 'ChatServiceå¯¼å…¥',
                    status: 'error',
                    message: `å¯¼å…¥å¤±è´¥: ${error.message}`
                });
            }
            
            displayResults('sendFlowResults', results);
        }

        // æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥
        function simulateUserInput() {
            const messageInput = findMessageInput();
            const sendBtn = findSendButton();
            
            if (messageInput && sendBtn) {
                const testMessage = 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯';
                
                // æ¨¡æ‹Ÿè¾“å…¥
                messageInput.value = testMessage;
                messageInput.dispatchEvent(new Event('input', { bubbles: true }));
                messageInput.dispatchEvent(new Event('change', { bubbles: true }));
                
                // æ£€æŸ¥æŒ‰é’®çŠ¶æ€
                setTimeout(() => {
                    const results = [{
                        name: 'æ¨¡æ‹Ÿè¾“å…¥',
                        status: 'success',
                        message: `è¾“å…¥äº†æµ‹è¯•æ¶ˆæ¯: "${testMessage}"`
                    }, {
                        name: 'æŒ‰é’®çŠ¶æ€',
                        status: sendBtn.disabled ? 'error' : 'success',
                        message: sendBtn.disabled ? 'æŒ‰é’®ä»ç„¶ç¦ç”¨' : 'æŒ‰é’®å·²æ¿€æ´»'
                    }];
                    
                    displayResults('sendFlowResults', results);
                }, 100);
            } else {
                displayResults('sendFlowResults', [{
                    name: 'æ¨¡æ‹Ÿè¾“å…¥',
                    status: 'error',
                    message: 'æ— æ³•æ‰¾åˆ°è¾“å…¥ç»„ä»¶'
                }]);
            }
        }

        // æ£€æŸ¥äº‹ä»¶å¤„ç†
        function checkEventHandlers() {
            const results = [];
            const messageInput = findMessageInput();
            const sendBtn = findSendButton();
            
            if (messageInput) {
                // æ£€æŸ¥è¾“å…¥äº‹ä»¶
                const hasInputHandler = messageInput.oninput || 
                    messageInput.addEventListener.toString().includes('input');
                results.push({
                    name: 'è¾“å…¥äº‹ä»¶å¤„ç†',
                    status: hasInputHandler ? 'success' : 'warning',
                    message: hasInputHandler ? 'è¾“å…¥äº‹ä»¶å¤„ç†å™¨å­˜åœ¨' : 'æœªæ£€æµ‹åˆ°è¾“å…¥äº‹ä»¶å¤„ç†å™¨'
                });
            }
            
            if (sendBtn) {
                // æ£€æŸ¥ç‚¹å‡»äº‹ä»¶
                const hasClickHandler = sendBtn.onclick || 
                    sendBtn.addEventListener.toString().includes('click');
                results.push({
                    name: 'ç‚¹å‡»äº‹ä»¶å¤„ç†',
                    status: hasClickHandler ? 'success' : 'warning',
                    message: hasClickHandler ? 'ç‚¹å‡»äº‹ä»¶å¤„ç†å™¨å­˜åœ¨' : 'æœªæ£€æµ‹åˆ°ç‚¹å‡»äº‹ä»¶å¤„ç†å™¨'
                });
            }
            
            displayResults('sendFlowResults', results);
        }

        // è¿è¡Œå®Œæ•´è¯Šæ–­
        function runDiagnostics() {
            const problems = [];
            const solutions = [];
            
            // æ£€æŸ¥å„ç§é—®é¢˜
            const chatId = getChatId();
            if (!chatId) {
                problems.push('âŒ æœªæ‰¾åˆ°ChatId');
                solutions.push('ç¡®ä¿ä½ åœ¨æ­£ç¡®çš„èŠå¤©é¡µé¢ /chat/{id}');
            }
            
            const messageInput = findMessageInput();
            if (!messageInput) {
                problems.push('âŒ æœªæ‰¾åˆ°MessageInputç»„ä»¶');
                solutions.push('æ£€æŸ¥MessageInput.vueç»„ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½');
            }
            
            const sendBtn = findSendButton();
            if (!sendBtn) {
                problems.push('âŒ æœªæ‰¾åˆ°å‘é€æŒ‰é’®');
                solutions.push('æ£€æŸ¥å‘é€æŒ‰é’®çš„CSSé€‰æ‹©å™¨å’ŒHTMLç»“æ„');
            } else if (sendBtn.disabled && messageInput?.value) {
                problems.push('âŒ æœ‰å†…å®¹ä½†å‘é€æŒ‰é’®ä»ç¦ç”¨');
                solutions.push('æ£€æŸ¥canSendè®¡ç®—å±æ€§çš„é€»è¾‘');
            }
            
            const results = [{
                name: 'è¯Šæ–­ç»“æœ',
                status: problems.length === 0 ? 'success' : 'error',
                message: problems.length === 0 ? 'æœªå‘ç°é—®é¢˜' : `å‘ç° ${problems.length} ä¸ªé—®é¢˜`
            }];
            
            if (problems.length > 0) {
                results.push({
                    name: 'é—®é¢˜åˆ—è¡¨',
                    status: 'error',
                    message: problems.join('\n')
                });
                
                results.push({
                    name: 'è§£å†³æ–¹æ¡ˆ',
                    status: 'warning',
                    message: solutions.join('\n')
                });
            }
            
            displayResults('diagnosticsResults', results);
        }

        // ç”Ÿæˆä¿®å¤å»ºè®®
        function generateFix() {
            const fixes = [];
            
            const chatId = getChatId();
            if (!chatId) {
                fixes.push('1. å¯¼èˆªåˆ°æ­£ç¡®çš„èŠå¤©é¡µé¢ï¼ŒURLåº”è¯¥æ˜¯ /chat/{æ•°å­—}');
            }
            
            const messageInput = findMessageInput();
            if (!messageInput) {
                fixes.push('2. æ£€æŸ¥MessageInput.vueç»„ä»¶æ˜¯å¦åœ¨Chat.vueä¸­æ­£ç¡®å¯¼å…¥å’Œä½¿ç”¨');
            }
            
            const sendBtn = findSendButton();
            if (!sendBtn) {
                fixes.push('3. æ£€æŸ¥å‘é€æŒ‰é’®çš„HTMLç»“æ„ï¼Œç¡®ä¿class="send-btn"å­˜åœ¨');
            }
            
            fixes.push('4. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œæ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰JavaScripté”™è¯¯');
            fixes.push('5. ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œåœ¨ localhost:5173');
            fixes.push('6. å°è¯•åˆ·æ–°é¡µé¢é‡æ–°åŠ è½½ç»„ä»¶');
            
            const results = [{
                name: 'ä¿®å¤å»ºè®®',
                status: 'warning',
                message: fixes.join('\n')
            }];
            
            displayResults('diagnosticsResults', results);
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults(containerId, results) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const html = results.map(result => `
                <div class="debug-result ${result.status}">
                    <div class="result-item">
                        <span class="status-indicator ${result.status}"></span>
                        <strong>${result.name}:</strong> ${result.message}
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateMonitoring();
            setInterval(updateMonitoring, 2000); // æ¯2ç§’æ›´æ–°ä¸€æ¬¡ç›‘æ§
            
            console.log('ğŸ” MessageInputè¯Šæ–­å·¥å…·å·²å¯åŠ¨');
            console.log('å¦‚æœå‘é€æ¶ˆæ¯ä¸èƒ½è§¦å‘ï¼Œè¯·ä½¿ç”¨è¿™äº›æŒ‰é’®è¿›è¡Œè¯Šæ–­');
        });
    </script>
</body>
</html>
