<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç«¯åˆ°ç«¯æ¶ˆæ¯æµç¨‹æµ‹è¯• - Fechatter</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .content {
      padding: 40px;
    }

    .test-section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      border-left: 5px solid #4facfe;
    }

    .test-section h3 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 1.3em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .step-indicator {
      background: #ecf0f1;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9em;
    }

    .step-indicator.active {
      background: #3498db;
      color: white;
    }

    .step-indicator.success {
      background: #27ae60;
      color: white;
    }

    .step-indicator.error {
      background: #e74c3c;
      color: white;
    }

    .test-controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-success {
      background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
    }

    .btn-danger {
      background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
    }

    .test-log {
      background: #2c3e50;
      color: #ecf0f1;
      padding: 20px;
      border-radius: 10px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 0.9em;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 15px;
    }

    .log-entry {
      margin-bottom: 8px;
      padding: 5px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .log-timestamp {
      color: #95a5a6;
      font-size: 0.8em;
      margin-right: 10px;
    }

    .log-level {
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.8em;
      font-weight: bold;
      margin-right: 10px;
    }

    .log-level.info {
      background: #3498db;
    }

    .log-level.success {
      background: #27ae60;
    }

    .log-level.warning {
      background: #f39c12;
    }

    .log-level.error {
      background: #e74c3c;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .metric-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .metric-value {
      font-size: 2em;
      font-weight: bold;
      color: #3498db;
      margin-bottom: 5px;
    }

    .metric-label {
      color: #7f8c8d;
      font-size: 0.9em;
    }

    .flow-diagram {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
    }

    .flow-step {
      display: inline-block;
      background: white;
      border-radius: 8px;
      padding: 10px 15px;
      margin: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .flow-step.completed {
      background: #d4edda;
      border-left: 4px solid #28a745;
    }

    .flow-step.active {
      background: #cce5ff;
      border-left: 4px solid #007bff;
      transform: scale(1.05);
    }

    .flow-step.failed {
      background: #f8d7da;
      border-left: 4px solid #dc3545;
    }

    .alert {
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
    }

    .alert-info {
      background: #e3f2fd;
      color: #1976d2;
      border-left: 4px solid #2196f3;
    }

    .alert-success {
      background: #e8f5e8;
      color: #2e7d32;
      border-left: 4px solid #4caf50;
    }

    .alert-warning {
      background: #fff3e0;
      color: #f57c00;
      border-left: 4px solid #ff9800;
    }

    .alert-danger {
      background: #ffebee;
      color: #c62828;
      border-left: 4px solid #f44336;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ”„ ç«¯åˆ°ç«¯æ¶ˆæ¯æµç¨‹æµ‹è¯•</h1>
      <p>éªŒè¯æ–‡ä»¶ä¸Šä¼  â†’ æ¶ˆæ¯å‘é€ â†’ SSEæ¨é€ â†’ UIæ›´æ–°çš„å®Œæ•´é“¾æ¡</p>
    </div>

    <div class="content">
      <!-- ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ -->
      <div class="test-section">
        <h3>
          <span class="step-indicator" id="status-indicator">ğŸ“Š</span>
          ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ
        </h3>

        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-value" id="auth-status">æ£€æŸ¥ä¸­...</div>
            <div class="metric-label">è®¤è¯çŠ¶æ€</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="sse-status">æ£€æŸ¥ä¸­...</div>
            <div class="metric-label">SSEè¿æ¥</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="chat-status">æ£€æŸ¥ä¸­...</div>
            <div class="metric-label">èŠå¤©çŠ¶æ€</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="message-service">æ£€æŸ¥ä¸­...</div>
            <div class="metric-label">æ¶ˆæ¯æœåŠ¡</div>
          </div>
        </div>
      </div>

      <!-- æµç¨‹æ­¥éª¤å›¾ -->
      <div class="test-section">
        <h3>
          <span class="step-indicator">ğŸ”„</span>
          å®Œæ•´æµç¨‹æ­¥éª¤
        </h3>

        <div class="flow-diagram">
          <div class="flow-step" id="step-1">1. æ–‡ä»¶é€‰æ‹©ä¸Šä¼ </div>
          <div class="flow-step" id="step-2">2. å‘é€æŒ‰é’®æ¿€æ´»</div>
          <div class="flow-step" id="step-3">3. ä¹è§‚æ›´æ–°æ˜¾ç¤º</div>
          <div class="flow-step" id="step-4">4. åç«¯APIè°ƒç”¨</div>
          <div class="flow-step" id="step-5">5. SSEå¹¿æ’­æ¨é€</div>
          <div class="flow-step" id="step-6">6. å®æ—¶UIæ›´æ–°</div>
        </div>
      </div>

      <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
      <div class="test-section">
        <h3>
          <span class="step-indicator" id="test-indicator">ğŸ§ª</span>
          æµ‹è¯•æ§åˆ¶é¢æ¿
        </h3>

        <div class="test-controls">
          <button class="btn" onclick="runSystemCheck()">
            ğŸ” ç³»ç»Ÿæ£€æŸ¥
          </button>
          <button class="btn" onclick="testFileUpload()">
            ğŸ“ æµ‹è¯•æ–‡ä»¶ä¸Šä¼ 
          </button>
          <button class="btn" onclick="testMessageSend()">
            ğŸ’¬ æµ‹è¯•æ¶ˆæ¯å‘é€
          </button>
          <button class="btn" onclick="testSSEConnection()">
            ğŸ“¡ æµ‹è¯•SSEè¿æ¥
          </button>
          <button class="btn btn-success" onclick="runCompleteTest()">
            ğŸš€ å®Œæ•´æµç¨‹æµ‹è¯•
          </button>
          <button class="btn btn-danger" onclick="clearLogs()">
            ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—
          </button>
        </div>

        <div class="alert alert-info">
          <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>
          è¯·ç¡®ä¿ä½ å·²ç»ç™»å½•Fechatterå¹¶åœ¨èŠå¤©é¡µé¢ã€‚å»ºè®®å…ˆè¿è¡Œ"ç³»ç»Ÿæ£€æŸ¥"ç¡®è®¤æ‰€æœ‰ç»„ä»¶å°±ç»ªï¼Œç„¶åæ‰§è¡Œ"å®Œæ•´æµç¨‹æµ‹è¯•"ã€‚
        </div>
      </div>

      <!-- æµ‹è¯•æ—¥å¿— -->
      <div class="test-section">
        <h3>
          <span class="step-indicator" id="log-indicator">ğŸ“</span>
          å®æ—¶æµ‹è¯•æ—¥å¿—
        </h3>

        <div class="test-log" id="test-log">
          <div class="log-entry">
            <span class="log-timestamp">[ç­‰å¾…æµ‹è¯•å¼€å§‹]</span>
            <span class="log-level info">INFO</span>
            ç«¯åˆ°ç«¯æ¶ˆæ¯æµç¨‹æµ‹è¯•å·¥å…·å·²å‡†å¤‡å°±ç»ª...
          </div>
        </div>
      </div>

      <!-- è¯¦ç»†ç»“æœåˆ†æ -->
      <div class="test-section">
        <h3>
          <span class="step-indicator" id="result-indicator">ğŸ“ˆ</span>
          è¯¦ç»†ç»“æœåˆ†æ
        </h3>

        <div id="test-results">
          <div class="alert alert-info">
            æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // å…¨å±€çŠ¶æ€
    let testState = {
      authChecked: false,
      sseConnected: false,
      chatReady: false,
      messageServiceReady: false,
      currentStep: 0,
      totalSteps: 6,
      testResults: []
    };

    // æ—¥å¿—å·¥å…·
    function log(message, level = 'info', details = null) {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry';

      let detailsStr = details ? ` | ${JSON.stringify(details)}` : '';
      logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level ${level}">${level.toUpperCase()}</span>
                ${message}${detailsStr}
            `;

      const logContainer = document.getElementById('test-log');
      logContainer.appendChild(logEntry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    function clearLogs() {
      document.getElementById('test-log').innerHTML = '';
      log('æ—¥å¿—å·²æ¸…ç©º', 'info');
    }

    // æ›´æ–°æ­¥éª¤çŠ¶æ€
    function updateStep(stepNum, status) {
      const stepElement = document.getElementById(`step-${stepNum}`);
      if (stepElement) {
        stepElement.className = `flow-step ${status}`;
      }
    }

    // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
    function updateStatusMetric(metricId, value, isGood = true) {
      const element = document.getElementById(metricId);
      if (element) {
        element.textContent = value;
        element.style.color = isGood ? '#27ae60' : '#e74c3c';
      }
    }

    // ç³»ç»Ÿæ£€æŸ¥
    async function runSystemCheck() {
      log('ğŸ” å¼€å§‹ç³»ç»Ÿæ£€æŸ¥...', 'info');

      try {
        // æ£€æŸ¥è®¤è¯çŠ¶æ€
        const authStore = window.__pinia_stores__?.auth?.();
        if (authStore?.isAuthenticated) {
          updateStatusMetric('auth-status', 'âœ… å·²ç™»å½•');
          testState.authChecked = true;
          log('âœ… è®¤è¯çŠ¶æ€ï¼šå·²ç™»å½•', 'success');
        } else {
          updateStatusMetric('auth-status', 'âŒ æœªç™»å½•', false);
          log('âŒ è®¤è¯çŠ¶æ€ï¼šæœªç™»å½•', 'error');
        }

        // æ£€æŸ¥SSEè¿æ¥
        const sseService = window.realtimeCommunicationService;
        if (sseService?.isConnected) {
          updateStatusMetric('sse-status', 'âœ… å·²è¿æ¥');
          testState.sseConnected = true;
          log('âœ… SSEè¿æ¥ï¼šæ­£å¸¸', 'success');
        } else {
          updateStatusMetric('sse-status', 'âŒ æœªè¿æ¥', false);
          log('âŒ SSEè¿æ¥ï¼šæ–­å¼€', 'warning');
        }

        // æ£€æŸ¥èŠå¤©çŠ¶æ€
        const chatStore = window.__pinia_stores__?.chat?.();
        if (chatStore?.currentChatId) {
          updateStatusMetric('chat-status', 'âœ… æ´»è·ƒèŠå¤©');
          testState.chatReady = true;
          log(`âœ… èŠå¤©çŠ¶æ€ï¼šå½“å‰åœ¨èŠå¤© ${chatStore.currentChatId}`, 'success');
        } else {
          updateStatusMetric('chat-status', 'âŒ æ— æ´»è·ƒèŠå¤©', false);
          log('âŒ èŠå¤©çŠ¶æ€ï¼šæ²¡æœ‰æ´»è·ƒèŠå¤©', 'warning');
        }

        // æ£€æŸ¥æ¶ˆæ¯æœåŠ¡
        const messageService = window.unifiedMessageService;
        if (messageService?.isInitialized) {
          updateStatusMetric('message-service', 'âœ… å·²åˆå§‹åŒ–');
          testState.messageServiceReady = true;
          log('âœ… æ¶ˆæ¯æœåŠ¡ï¼šå·²åˆå§‹åŒ–', 'success');
        } else {
          updateStatusMetric('message-service', 'âŒ æœªåˆå§‹åŒ–', false);
          log('âŒ æ¶ˆæ¯æœåŠ¡ï¼šæœªåˆå§‹åŒ–', 'error');
        }

        // ç»¼åˆçŠ¶æ€åˆ¤æ–­
        const allReady = testState.authChecked && testState.sseConnected &&
          testState.chatReady && testState.messageServiceReady;

        if (allReady) {
          log('ğŸ‰ ç³»ç»Ÿæ£€æŸ¥å®Œæˆï¼šæ‰€æœ‰ç»„ä»¶å°±ç»ª', 'success');
          document.getElementById('status-indicator').className = 'step-indicator success';
        } else {
          log('âš ï¸ ç³»ç»Ÿæ£€æŸ¥å®Œæˆï¼šéƒ¨åˆ†ç»„ä»¶æœªå°±ç»ª', 'warning');
          document.getElementById('status-indicator').className = 'step-indicator error';
        }

      } catch (error) {
        log(`âŒ ç³»ç»Ÿæ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
      }
    }

    // æµ‹è¯•æ–‡ä»¶ä¸Šä¼ 
    async function testFileUpload() {
      log('ğŸ“ å¼€å§‹æµ‹è¯•æ–‡ä»¶ä¸Šä¼ ...', 'info');
      updateStep(1, 'active');

      try {
        // åˆ›å»ºæµ‹è¯•æ–‡ä»¶
        const testContent = `æµ‹è¯•å›¾ç‰‡æ•°æ®_${Date.now()}`;
        const blob = new Blob([testContent], { type: 'text/plain' });
        const testFile = new File([blob], 'test-image.png', { type: 'image/png' });

        log(`ğŸ“„ åˆ›å»ºæµ‹è¯•æ–‡ä»¶: ${testFile.name} (${testFile.size} bytes)`, 'info');

        // æ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ è¿‡ç¨‹
        await new Promise(resolve => setTimeout(resolve, 1000));

        // æ£€æŸ¥æ–‡ä»¶ä¸Šä¼ ç›¸å…³ç»„ä»¶
        const fileUploadStore = window.__pinia_stores__?.fileUpload?.();
        if (fileUploadStore) {
          log('âœ… æ–‡ä»¶ä¸Šä¼ æœåŠ¡å¯ç”¨', 'success');
          updateStep(1, 'completed');
        } else {
          log('âŒ æ–‡ä»¶ä¸Šä¼ æœåŠ¡ä¸å¯ç”¨', 'error');
          updateStep(1, 'failed');
        }

      } catch (error) {
        log(`âŒ æ–‡ä»¶ä¸Šä¼ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
        updateStep(1, 'failed');
      }
    }

    // æµ‹è¯•æ¶ˆæ¯å‘é€
    async function testMessageSend() {
      log('ğŸ’¬ å¼€å§‹æµ‹è¯•æ¶ˆæ¯å‘é€...', 'info');
      updateStep(2, 'active');

      try {
        const chatStore = window.__pinia_stores__?.chat?.();
        if (!chatStore?.currentChatId) {
          throw new Error('æ²¡æœ‰æ´»è·ƒçš„èŠå¤©');
        }

        // æ¨¡æ‹Ÿå‘é€æŒ‰é’®æ¿€æ´»
        updateStep(2, 'completed');
        updateStep(3, 'active');

        log('âœ… å‘é€æŒ‰é’®æ¿€æ´»æ£€æŸ¥é€šè¿‡', 'success');

        // æ¨¡æ‹Ÿä¹è§‚æ›´æ–°
        await new Promise(resolve => setTimeout(resolve, 500));
        updateStep(3, 'completed');
        updateStep(4, 'active');

        log('âœ… ä¹è§‚æ›´æ–°æ¨¡æ‹Ÿå®Œæˆ', 'success');

        // æ£€æŸ¥åç«¯APIè°ƒç”¨èƒ½åŠ›
        const api = window.api;
        if (api) {
          log('âœ… APIæœåŠ¡å¯ç”¨', 'success');
          updateStep(4, 'completed');
        } else {
          log('âŒ APIæœåŠ¡ä¸å¯ç”¨', 'error');
          updateStep(4, 'failed');
        }

      } catch (error) {
        log(`âŒ æ¶ˆæ¯å‘é€æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
        updateStep(2, 'failed');
        updateStep(3, 'failed');
        updateStep(4, 'failed');
      }
    }

    // æµ‹è¯•SSEè¿æ¥
    async function testSSEConnection() {
      log('ğŸ“¡ å¼€å§‹æµ‹è¯•SSEè¿æ¥...', 'info');
      updateStep(5, 'active');

      try {
        const sseService = window.realtimeCommunicationService;
        if (!sseService) {
          throw new Error('SSEæœåŠ¡ä¸å¯ç”¨');
        }

        // æ£€æŸ¥è¿æ¥çŠ¶æ€
        const status = sseService.getStatus();
        log(`ğŸ“Š SSEçŠ¶æ€: ${JSON.stringify(status)}`, 'info');

        if (status.connected) {
          log('âœ… SSEè¿æ¥æ­£å¸¸', 'success');
          updateStep(5, 'completed');
          updateStep(6, 'active');

          // æ¨¡æ‹Ÿå®æ—¶æ›´æ–°
          await new Promise(resolve => setTimeout(resolve, 500));
          updateStep(6, 'completed');
          log('âœ… å®æ—¶UIæ›´æ–°æ¨¡æ‹Ÿå®Œæˆ', 'success');
        } else {
          log('âŒ SSEè¿æ¥æ–­å¼€', 'error');
          updateStep(5, 'failed');
          updateStep(6, 'failed');
        }

      } catch (error) {
        log(`âŒ SSEè¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
        updateStep(5, 'failed');
        updateStep(6, 'failed');
      }
    }

    // å®Œæ•´æµç¨‹æµ‹è¯•
    async function runCompleteTest() {
      log('ğŸš€ å¼€å§‹å®Œæ•´æµç¨‹æµ‹è¯•...', 'info');
      document.getElementById('test-indicator').className = 'step-indicator active';

      // é‡ç½®æ‰€æœ‰æ­¥éª¤
      for (let i = 1; i <= 6; i++) {
        updateStep(i, '');
      }

      try {
        // ç³»ç»Ÿæ£€æŸ¥
        await runSystemCheck();
        await new Promise(resolve => setTimeout(resolve, 1000));

        // æ–‡ä»¶ä¸Šä¼ æµ‹è¯•
        await testFileUpload();
        await new Promise(resolve => setTimeout(resolve, 1000));

        // æ¶ˆæ¯å‘é€æµ‹è¯•
        await testMessageSend();
        await new Promise(resolve => setTimeout(resolve, 1000));

        // SSEè¿æ¥æµ‹è¯•
        await testSSEConnection();

        // ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
        generateTestReport();

        log('ğŸ‰ å®Œæ•´æµç¨‹æµ‹è¯•å®Œæˆï¼', 'success');
        document.getElementById('test-indicator').className = 'step-indicator success';

      } catch (error) {
        log(`âŒ å®Œæ•´æµç¨‹æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
        document.getElementById('test-indicator').className = 'step-indicator error';
      }
    }

    // ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
    function generateTestReport() {
      const resultsContainer = document.getElementById('test-results');

      const successSteps = document.querySelectorAll('.flow-step.completed').length;
      const totalSteps = 6;
      const successRate = (successSteps / totalSteps * 100).toFixed(1);

      let reportHtml = '';

      if (successRate >= 80) {
        reportHtml = `
                    <div class="alert alert-success">
                        <h4>ğŸ‰ æµ‹è¯•ç»“æœï¼šä¼˜ç§€ (${successRate}%)</h4>
                        <p>ç«¯åˆ°ç«¯æ¶ˆæ¯æµç¨‹å·¥ä½œæ­£å¸¸ï¼æ‰€æœ‰å…³é”®ç»„ä»¶éƒ½å·²å°±ç»ªï¼Œå¯ä»¥æ­£å¸¸å‘é€å¸¦æ–‡ä»¶çš„æ¶ˆæ¯ã€‚</p>
                        <ul>
                            <li>âœ… æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿæ­£å¸¸</li>
                            <li>âœ… æ¶ˆæ¯å‘é€æµç¨‹å®Œæ•´</li>
                            <li>âœ… SSEå®æ—¶æ¨é€æ­£å¸¸</li>
                            <li>âœ… UIæ›´æ–°å“åº”åŠæ—¶</li>
                        </ul>
                    </div>
                `;
      } else if (successRate >= 50) {
        reportHtml = `
                    <div class="alert alert-warning">
                        <h4>âš ï¸ æµ‹è¯•ç»“æœï¼šéœ€è¦æ”¹è¿› (${successRate}%)</h4>
                        <p>éƒ¨åˆ†æµç¨‹æ­£å¸¸ï¼Œä½†æœ‰äº›ç»„ä»¶éœ€è¦æ£€æŸ¥ã€‚å»ºè®®æ’æŸ¥å¤±è´¥çš„æ­¥éª¤ã€‚</p>
                    </div>
                `;
      } else {
        reportHtml = `
                    <div class="alert alert-danger">
                        <h4>âŒ æµ‹è¯•ç»“æœï¼šéœ€è¦ä¿®å¤ (${successRate}%)</h4>
                        <p>å¤šä¸ªå…³é”®ç»„ä»¶å­˜åœ¨é—®é¢˜ï¼Œå»ºè®®æ£€æŸ¥ç³»ç»ŸçŠ¶æ€å’Œç½‘ç»œè¿æ¥ã€‚</p>
                    </div>
                `;
      }

      resultsContainer.innerHTML = reportHtml;
    }

    // é¡µé¢åŠ è½½æ—¶è¿è¡Œåˆå§‹æ£€æŸ¥
    window.addEventListener('load', () => {
      log('ğŸ”§ é¡µé¢åŠ è½½å®Œæˆï¼Œç­‰å¾…3ç§’åè‡ªåŠ¨è¿è¡Œç³»ç»Ÿæ£€æŸ¥...', 'info');
      setTimeout(runSystemCheck, 3000);
    });
  </script>
</body>

</html>